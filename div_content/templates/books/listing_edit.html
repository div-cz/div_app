{% extends "books/base.html" %}
{% load humanize %}
{% load custom_filters %}

{% block title %}Upravit nab√≠dku {{ book.title }} | DIV.cz{% endblock %}

{% block content %}

<style>
/* === UNIVERZ√ÅLN√ç FORM CONTROL === */
input[type="text"],
input[type="number"],
input[type="email"],
input[type="tel"],
select,
textarea {
    height: 48px;
    padding: 10px 14px;
    font-size: 16px;
    line-height: 1.4;
    border-radius: 12px;
    border: 1px solid #d1d5db;
    background-color: #fff;
    box-sizing: border-box;
}

.dark input[type="text"],
.dark input[type="number"],
.dark input[type="email"],
.dark input[type="tel"],
.dark select,
.dark textarea {
    background-color: #1A161F;
    border-color: #374151;
    color: #fff;
}

/* textarea v√Ωjimka */
textarea {
    height: auto;
    min-height: 120px;
}

/* === SELECT ‚Äì srovnat text vertik√°lnƒõ === */
select {
    padding-right: 40px;
    line-height: 1.4;
}

/* === Disabled select === */
select.disabled-select {
    background-color: #f3f4f6;
    color: #6b7280;
    cursor: not-allowed;
}

.dark select.disabled-select {
    background-color: #374151;
    color: #9ca3af;
}

/* === NUMBER INPUT ‚Äì spinner fix === */
input[type="number"] {
    appearance: textfield;
    -moz-appearance: textfield;
}

input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
    height: 100%;
}

/* === CHECKBOXY ‚Äì vƒõt≈°√≠ a konzistentnƒõj≈°√≠ === */
input[type="checkbox"] {
    width: 24px;
    height: 24px;
    accent-color: #22c55e;
    cursor: pointer;
    flex-shrink: 0;
}

label {
    cursor: pointer;
}
</style>

<div class="container mx-auto px-4 py-8" style="margin-top:20px">
    
    <h1 class="mt-8">
        <a href="/antikvariat/">DIVkvari√°t</a> /
        <a href="{% url 'listing_detail_sell' book_url=book.url listing_id=listing.booklistingid %}">
            Zpƒõt na nab√≠dku
        </a>
    </h1>
    <hr>

    {% if messages %}
    <div class="mt-3">
        {% for message in messages %}
            <div class="my-4 p-3 rounded bg-success-subtle alert-{{ message.tags }}">
                {{ message|safe }}
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="card mb-6">
        <div class="card-body dark:bg-[#0d0c0f] rounded-1xl">
            <h3 class="text-xl mb-4">Upravit nab√≠dku</h3>
            
            <div class="flex items-start mb-6">
                {% if book.img == "noimg.png" %}
                <img src="/static/img/book/book.png" alt="{{ book.titlecz|default:book.title }}" class="w-24 h-auto mr-4" style="max-width:200px">
                {% elif book.img == "GoogleID" %}
                <img src="https://books.google.com/books/content?id={{ book.googleid }}&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api" alt="{{ book.titlecz|default:book.title }}" class="w-24 h-auto mr-4" style="max-width:200px">
                {% else %}
                <img src="https://media.div.cz/knihy/{{ book.img }}" alt="{{ book.titlecz|default:book.title }}" class="w-24 h-auto mr-4" style="max-width:200px">
                {% endif %}
                
                <div>
                    <h4 class="font-bold text-lg">{{ book.titlecz|default:book.title }}</h4>
                    <p class="text-gray-600 dark:text-gray-400">{{ book.author }}</p>
                </div>
            </div>

            {% if listing.images.all %}
            <div class="mb-4 flex flex-wrap gap-2">
                {% for img in listing.images.all %}
                    <img src="{{ img.image.url }}" class="rounded" style="max-width:130px;">
                {% endfor %}
            </div>
            {% endif %}
            
            <form method="post" class="space-y-8">
                {% csrf_token %}
                
                <!-- SEKCE: Z√°kladn√≠ informace -->
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-gray-700 dark:text-gray-300">Z√°kladn√≠ informace</h4>
                    
                    <!-- Typ a Cena -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-2 font-medium">Typ *</label>
                            <select disabled class="disabled-select">
                                <option>Prod√°m</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block mb-2 font-medium">Cena *</label>
                            <input type="number"
                                   name="new_price"
                                   min="0"
                                   required
                                   value="{{ listing.price|floatformat:0 }}">
                        </div>
                    </div>
                    
                    <!-- Popis -->
                    <div>
                        <label class="block mb-2 font-medium">Popis *</label>
                        <textarea name="new_description" rows="5">{{ listing.description }}</textarea>
                    </div>
                </div>
                
                <hr class="border-gray-200 dark:border-gray-700">
                
                <!-- SEKCE: Stav a edice -->
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-gray-700 dark:text-gray-300">Stav a edice</h4>
                    
                    <!-- Stav knihy a Rok vyd√°n√≠ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-2 font-medium">Stav knihy</label>
                            <select name="condition">
                                <option value="">-- Vyberte --</option>
                                <option value="nova" {% if listing.condition == "nova" %}selected{% endif %}>Nov√°</option>
                                <option value="jako-nova" {% if listing.condition == "jako-nova" %}selected{% endif %}>Pou≈æit√°, jako nov√°</option>
                                <option value="dobry" {% if listing.condition == "dobry" %}selected{% endif %}>Pou≈æit√°, dobr√Ω stav</option>
                                <option value="zachovaly" {% if listing.condition == "zachovaly" %}selected{% endif %}>Pou≈æit√°, zachoval√Ω stav</option>
                                <option value="spatny" {% if listing.condition == "spatny" %}selected{% endif %}>≈†patn√Ω stav</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block mb-2 font-medium">Rok vyd√°n√≠</label>
                            <input type="number"
                                   name="editionyear"
                                   value="{{ listing.editionyear|default:'' }}"
                                   placeholder="(volitelnƒõ)">
                        </div>
                    </div>
                    
                    <!-- Prvn√≠ vyd√°n√≠ -->
                    <div class="flex items-center gap-3">
                        <input type="checkbox"
                               name="firstedition"
                               id="id_firstedition"
                               {% if listing.firstedition %}checked{% endif %}>
                        <label for="id_firstedition" class="font-medium">Prvn√≠ vyd√°n√≠</label>
                    </div>
                    
                    <!-- Ediƒçn√≠ pozn√°mka -->
                    <div>
                        <label class="block mb-2 font-medium">Ediƒçn√≠ pozn√°mka</label>
                        <input type="text"
                               name="edition_note"
                               value="{{ listing.edition_note|default:'' }}"
                               placeholder="(volitelnƒõ)">
                    </div>
                </div>
                
                <hr class="border-gray-200 dark:border-gray-700">
                
                <!-- SEKCE: Kontakt a doruƒçen√≠ -->
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-gray-700 dark:text-gray-300">Kontakt a doruƒçen√≠</h4>
                    
                    <!-- Osobn√≠ p≈ôevzet√≠ a M√≠sto -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                        <div class="flex items-center gap-3">
                            <input type="checkbox"
                                   name="personal_pickup"
                                   id="id_personal_pickup"
                                   {% if "OSOBNI" in listing.shippingoptions %}checked{% endif %}>
                            <label for="id_personal_pickup" class="font-medium">Osobn√≠ p≈ôevzet√≠</label>
                        </div>
                        
                        <div>
                            <label class="block mb-2 font-medium">M√≠sto</label>
                            <input type="text"
                                   name="new_location"
                                   value="{{ listing.location|default:'' }}"
                                   placeholder="nap≈ô. Praha, Brno...">
                        </div>
                    </div>
                    
                    <!-- Po≈°tovn√© -->
                    <div>
                        <label class="block mb-3 font-medium">Mo≈ænosti po≈°tovn√©ho</label>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Z√°silkovna -->
                            <div>
                                <label class="flex items-center gap-3 font-medium mb-2">
                                    <input type="checkbox"
                                           name="shipping_zasilkovna"
                                           id="id_shipping_zasilkovna"
                                           {% if "ZASILKOVNA" in listing.shippingoptions %}checked{% endif %}>
                                    <span>Z√°silkovna</span>
                                </label>
                                <input type="number"
                                       name="shipping_zasilkovna_price"
                                       min="0"
                                       value="{{ current_shipping.ZASILKOVNA|default:'89' }}">
                            </div>
                            
                            <!-- Bal√≠kovna -->
                            <div>
                                <label class="flex items-center gap-3 font-medium mb-2">
                                    <input type="checkbox"
                                           name="shipping_balikovna"
                                           id="id_shipping_balikovna"
                                           {% if "BALIKOVNA" in listing.shippingoptions %}checked{% endif %}>
                                    <span>Bal√≠kovna</span>
                                </label>
                                <input type="number"
                                       name="shipping_balikovna_price"
                                       min="0"
                                       value="{{ current_shipping.BALIKOVNA|default:'99' }}">
                            </div>
                            
                            <!-- ƒåesk√° po≈°ta -->
                            <div>
                                <label class="flex items-center gap-3 font-medium mb-2">
                                    <input type="checkbox"
                                           name="shipping_posta"
                                           id="id_shipping_posta"
                                           {% if "POSTA" in listing.shippingoptions %}checked{% endif %}>
                                    <span>ƒåesk√° po≈°ta</span>
                                </label>
                                <input type="number"
                                       name="shipping_posta_price"
                                       min="0"
                                       value="{{ current_shipping.POSTA|default:'109' }}">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tlaƒç√≠tka -->
                <div class="flex gap-4">
                    <button type="submit" class="add-book">
                        üíæ Ulo≈æit zmƒõny
                    </button>
    <a href="{% url 'listing_detail_sell' book_url=book.url listing_id=listing.booklistingid %}"
       class="add-book"
       style="background-color: #6c757d; text-decoration: none; display: inline-block;">
        Zru≈°it
    </a>                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}
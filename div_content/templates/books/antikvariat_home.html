{% extends "books/base.html" %}
{% block title %}Antikvariát | DIV.cz{% endblock %}

{% block meta %}
<meta name="description" content="DIVkvariát – burza knih a poptávka čtenářů. Přidej svoji nabídku nebo poptávku.">
<link rel="canonical" href="https://div.cz/antikvariat/">
{% endblock %}

{% block content %}
<<<<<<< HEAD
<div class="container">
=======
<div class="container mx-auto px-4 py-6">
>>>>>>> origin/wendy_css
    <h1 class="mt-8">DIVkvariát</h1>
    <p class="mb-8 text-lg">Burza knih mezi čtenáři – přehledné nabídky a poptávky z druhé ruky.<br>
    Nabídku můžete zadat z detailu knihy nebo <a href="/antikvariat/pridat-knihu/">přes formulář přidat knihu</a></p>
    <p class="mb-8 text-lg">Burza knih mezi čtenáři – přehledné nabídky a poptávky z druhé ruky.</p>

{% if messages %}
    <div class="mt-3">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}" role="alert" style="background-color: #d4edda; color: #155724; border-color: #c3e6cb;margin:30px 10px;padding:10px">
            {{ message|safe }}
        </div>
    {% endfor %}
    </div>
{% endif %}
 
    <div class="flex flex-col sm:flex-row gap-4 mb-12">
        <div class="flex-1 border sm:w-full rounded p-4">
            <p class="text-xl font-bold mb-2">&#128228; Nabídky</p>
            <a href="{% url 'books_market_offers' %}">
                <p class="text-green-700 font-medium">{{ count_sell }} aktivních knih k prodeji či darování</p>
            </a>
        </div>
        <div class="flex-1 border sm:w-full rounded p-4">
            <p class="text-xl font-bold mb-2">&#128373; Poptávky</p>
            <a href="{% url 'books_market_wants' %}">
                <div class="text-green-700 font-medium">{{ count_buy }} čtenářských přání</div>
            </a>
        </div>

    {% if request.user.is_authenticated %}
        <div class="flex-1 border rounded p-4 bg-[#F9F9F9] dark:bg-[#1A161F]">
            <div class="text-xl font-bold mb-2">&#128179; Výplata</div>
            <ul class="text-sm space-y-1">
                <li><strong>K vyplacení:</strong> {{ total_user_payment|default:"0" }} Kč</li>
                <li><strong>Vyplaceno:</strong> {{ total_user_paid_amount|default:"0" }} Kč</li>
            </ul>

            {% if total_user_payment > 0 and button_appear %}
                {% if user.userprofile.bankaccount %}
                <form method="post" class="mt-2">
                    {% csrf_token %}
                    <button type="submit" name="request_payout" class="add-book w-full">
                        Vyžádat výplatu
                    </button>
                </form>
                    {% else %}
                <p class="text-xs mt-2">Pro výplatu je nutné vyplnit číslo účtu na 
                    <a href="/ucet/upravit/" class="underline">profilu</a>.
                </p>
                {% endif %}
            {% endif %}
        </div>
    {% endif %}
    </div>

    <!-- Nejnovější nabídky -->
    {% if listings_sell %}
    <h2 class="text-2xl font-semibold mb-4 mt-10">&#128218; Nejnovější nabídky</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for listing in listings_sell %}
        <div class="border rounded bg-white dark:bg-[#0d0c0f] p-4">
            <div class="flex gap-4">
                <a href="{% url 'listing_detail_sell' listing.book.url listing.booklistingid %}">
                {% if listing.book.img == "noimg.png" %}
                    <img src="/static/img/book/book.png" alt="{{ listing.book.titlecz }}" class="w-16 rounded" style="max-width:150px">
                {% elif listing.book.img == "GoogleID" %}
                    <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1" class="w-16 rounded">
                {% else %}
                    <img src="https://media.div.cz/knihy/{{ listing.book.img }}" class="w-16 rounded" alt="{{ listing.book.titlecz }}" style="max-width:150px">
                {% endif %}
                </a>
                <div class="flex flex-col justify-between flex-1">
                    <div>
                        <strong>{{ listing.book.titlecz|default:listing.book.title }}</strong><br>
                        <span class="text-sm text-gray-600 dark:text-gray-300">Autor: {{ listing.book.author }}</span>
                    </div>
                    <div class="mt-2">
                        <span class="text-green-800 font-medium">
                            {% if listing.price %}{{ listing.price|floatformat:0 }} Kč{% else %}Daruji{% endif %}
                        </span><br>
                        <a href="{% url 'listing_detail_sell' listing.book.url listing.booklistingid %}" class="text-green-700 hover:underline text-sm">Detail nabídky</a>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
    </div>

    <!-- paginátor -->
<<<<<<< HEAD
    <div class="pagination">
        <span class="step-links">
            {% if listings_sell.has_previous %}
                <a class="first-page" href="?page_sell={{ listings_sell.previous_page_number }}">&laquo; Předchozí</a>
                {% else %}
            {% endif %}

            <span class="current-page">
                {{ listings_sell.number }} / {{ listings_sell.paginator.num_pages }}
            </span>

            {% if listings_sell.has_next %}
                <a class="last-page" href="?page_sell={{ listings_sell.next_page_number }}">Další &raquo;</a>
                {% else %}
            {% endif %}
=======
    <div class="pagination mt-8">
        <span class="step-links flex justify-center">
            <div>
            {% if listings_sell.has_previous %}
                <a href="?page_sell={{ listings_sell.previous_page_number }}">&laquo; Předchozí</a>
                {% else %}
                <span></span>
            {% endif %}
            </div>

            <span class="current-page mx-4">
                Strana {{ listings_sell.number }} z {{ listings_sell.paginator.num_pages }}</span>

            <div>
            {% if listings_sell.has_next %}
                <a href="?page_sell={{ listings_sell.next_page_number }}">Další &raquo;</a>
                {% else %}
                <span></span>
            {% endif %}
            </div>
>>>>>>> origin/wendy_css
        </span>
    </div>
{% endif %}

</div>
{% endblock %}

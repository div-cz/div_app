<!-- správa ocenění -->
{% extends "awards/base.html" %}
{% load static %}

{% block title %}Správa ocenění - Admin - DIV.cz{% endblock %}

{% block meta %}

{% endblock %}

{% block content %}

<h2 style="width: 100%; margin-bottom: 1.6rem;">&#128295; Správa ocenění</h2>

<div class="mb-3 d-flex gap-2 flex-wrap">
    <a href="{% url 'admin_award_add' %}" class="btn btn add">&#10133; Nové ocenění</a>
    <a href="{% url 'awards_movies' %}" class="btn add-movie">&#127909; Filmy</a>
    <a href="{% url 'awards_books' %}" class="btn add-book">&#128214; Knihy</a>
    <a href="{% url 'awards_games' %}" class="btn add-game">&#127918; Hry</a>
</div>

{% if page_obj %}
    <div class="award-grid-container">
        <div class="award-grid-header">
            <div class="award-name">Název</div>
            <div class="award-type">Typ</div>
            <div class="award-year">Rok</div>
            <div class="award-nominations">Nominace</div>
            <div class="award-winners">Vítězové</div>
            <div class="award-actions">Akce</div>
        </div>

        {% for award in page_obj %}
            <div class="award-grid-row">
                <div class="award-name-cell">
                    <a href="{% url 'award_detail' award.slug award.year %}" 
                        class="award-title 
                        {% if award.awardtype == 'film' %}
                            movies
                        {% elif award.awardtype == 'book' %}
                            books
                        {% elif award.awardtype == 'game' %}
                            games
                        {% endif %}">
                        {{ award.awardname }}
                    </a>
                    <br>
                    <small class="text-muted">{{ award.description|truncatewords:10 }}</small>
                </div>
                <div class="award-type">
                    {% if award.awardtype == 'film' %} &#127909; Film
                        {% elif award.awardtype == 'book' %} &#128214; Kniha
                        {% elif award.awardtype == 'game' %} &#127918; Hra
                    {% endif %}
                </div>
                <div class="award-year">{{ award.year }}</div>
                <div class="award-nominations">
                    {% if award.awardtype == 'film' %}{{ award.movieaward_set.count }}
                        {% elif award.awardtype == 'book' %}{{ award.bookaward_set.count }}
                        {% elif award.awardtype == 'game' %}{{ award.gameaward_set.count }}
                    {% endif %}
                </div>
                <div class="award-winners">
                    {% if award.awardtype == 'film' %}{{ award.movieaward_set.filter_winners.count }}
                        {% elif award.awardtype == 'book' %}{{ award.bookaward_set.filter_winners.count }}
                        {% elif award.awardtype == 'game' %}{{ award.gameaward_set.filter_winners.count }}
                    {% endif %}
                </div>
                <div class="award-actions">
                    <div class="btn-group">
                        <a href="{% url 'admin_award_nominees' award.metaawardid %}" class="btn btn add" style="width: 50px; padding: 5px;" title="správa nominací">&#128221;</a>
                        <a href="{% url 'admin_award_edit' award.metaawardid %}" class="btn btn add" style="width: 50px; padding: 5px;" title="upravit ocenění">&#9999;</a>
                        <a href="{% url 'award_detail' award.slug award.year %}" class="btn btn add" style="width: 50px; padding: 5px;" title="nominace">&#128220;</a>
                        <button class="btn btn add" style="width: 50px; padding: 5px;" title="smazat" onclick="confirmDelete('{{ award.awardname }}', '{{ award.year }}', '{{ award.metaawardid }}')">&#128465;</button>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- PAGINÁTOR -->
    {% if page_obj.has_other_pages %}
        <div class="pagination">
            <span class="step-links">
                {% if page_obj.has_previous %}
                    <a class="first-page" href="?page=1">&laquo; První</a>
                    <a href="?page={{ page_obj.previous_page_number }}">Předchozí</a>
                {% endif %}

                    <span class="page-link">
                        / 
                    </span>

                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}">Další</a>
                    <a class="last-page" href="">Poslední &raquo;</a>
                {% endif %}
            </span>
        </div>
    {% endif %}

    {% else %}
    <div class="alert alert-info">Zatím nejsou žádná ocenění.</div>
{% endif %}

<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Potvrdit smazání</h5>
                <button type="button" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Opravdu chcete smazat ocenění <strong id="deleteAwardName"></strong> (<strong id="deleteAwardYear"></strong>)?</p>
                <p>Tato akce je nevratná a smaže i všechny nominace.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn add" data-bs-dismiss="modal">&#10060; Zrušit</button>
                <a href="#" class="btn btn add" id="confirmDeleteBtn">&#128465; Smazat</a>
            </div>
        </div>
    </div>
</div>

<script>
    function confirmDelete(awardName, awardYear, awardId) {
        document.getElementById('deleteAwardName').textContent = awardName;
        document.getElementById('deleteAwardYear').textContent = awardYear;
        document.getElementById('confirmDeleteBtn').href = "{% url 'admin_award_delete' 0 %}".replace('0', awardId);
        const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
        modal.show();
    }
</script>

{% endblock %}
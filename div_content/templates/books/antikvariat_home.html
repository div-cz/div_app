{% extends "books/base.html" %}
{% block title %}Antikvariát | DIV.cz{% endblock %}

{% block meta %}
<meta name="description" content="DIVkvariát – burza knih a poptávka čtenářů. Přidej svoji nabídku nebo poptávku.">
<link rel="canonical" href="https://div.cz/antikvariat/">
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-10">
    <h1 class="text-3xl font-semibold mb-4">DIVkvariát</h1>
    <p class="mb-8 text-lg">Burza knih mezi čtenáři – přehledné nabídky a poptávky z druhé ruky.</p>


{% if messages %}
    <div class="mt-3">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}" role="alert" style="background-color: #d4edda; color: #155724; border-color: #c3e6cb;margin:30px 10px;padding:10px">
            {{ message|safe }}
        </div>
    {% endfor %}
    </div>
{% endif %}


<div class="flex flex-col sm:flex-row gap-4 mb-12">
    <a href="{% url 'books_market_offers' %}" class="flex-1 border rounded p-4 hover:bg-gray-100 dark:hover:bg-[#1a1a1a] transition">
        <div class="text-xl font-bold mb-2">&#128218; Nabídky</div>
        <div class="text-green-700 font-medium">{{ count_sell }} aktivních knih k prodeji či darování</div>
    </a>
    <a href="{% url 'books_market_wants' %}" class="flex-1 border rounded p-4 hover:bg-gray-100 dark:hover:bg-[#1a1a1a] transition">
        <div class="text-xl font-bold mb-2">&#128214; Poptávky</div>
        <div class="text-green-700 font-medium">{{ count_buy }} čtenářských přání</div>
    </a>

    {% if request.user.is_authenticated %}
    <div class="flex-1 border rounded p-4 bg-[#F9F9F9] dark:bg-[#1A161F]">
        <div class="text-xl font-bold mb-2">&#128179; Výplata</div>
        <ul class="text-sm space-y-1">
            <li><strong>K vyplacení:</strong> {{ total_user_payment|default:"0" }} Kč</li>
            <li><strong>Vyplaceno:</strong> {{ total_user_paid_amount|default:"0" }} Kč</li>
        </ul>

        {% if total_user_payment > 0 and button_appear %}
            {% if user.userprofile.bankaccount %}
            <form method="post" class="mt-2">
                {% csrf_token %}
                <button type="submit" name="request_payout" class="btn btn-primary w-full">
                    Vyžádat výplatu
                </button>
            </form>
            {% else %}
            <p class="text-xs mt-2">Pro výplatu je nutné vyplnit číslo účtu na 
                <a href="/ucet/upravit/" class="underline">profilu</a>.
            </p>
            {% endif %}
        {% endif %}
    </div>
    {% endif %}
</div>


    {% if random_listings %}
        <h2 class="text-2xl font-semibold mb-4 mt-10">&#128161; Náhodné nabídky</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for listing in random_listings %}
                <div class="border rounded bg-white dark:bg-[#0d0c0f] p-4">
                    <div class="flex gap-4">
                        <a href="{% url 'book_detail' listing.book.url %}">
                            {% if listing.book.img == "noimg.png" %}
                                <img src="/static/img/book/book.png" alt="{{ listing.book.titlecz }}" class="w-16 rounded">
                            {% elif listing.book.img == "GoogleID" %}
                                <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1" class="w-16 rounded">
                            {% else %}
                                <img src="https://media.div.cz/knihy/{{ listing.book.img }}" class="w-16 rounded" alt="{{ listing.book.titlecz }}">
                            {% endif %}
                        </a>
                        <div class="flex flex-col justify-between flex-1">
                            <div>
                                <strong>{{ listing.book.titlecz|default:listing.book.title }}</strong><br>
                                <span class="text-sm text-gray-600 dark:text-gray-300">Autor: {{ listing.book.author }}</span>
                            </div>
                            <div class="mt-2">
                                <span class="text-green-800 font-medium">
                                    {% if listing.price %}{{ listing.price|floatformat:0 }} Kč{% else %}Daruji{% endif %}
                                </span><br>
                                <a href="{% url 'listing_detail_sell' listing.book.url listing.booklistingid %}" class="text-green-700 hover:underline text-sm">Detail nabídky</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endblock %}

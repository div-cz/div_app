{% extends "divkvariat/base.html" %}
{% load humanize %}

{% block title %}Popt√°vky knih | DIVkvari√°t{% endblock %}

{% block meta %}
<meta name="description" content="Popt√°vky knih od ƒçten√°≈ô≈Ø na DIVkvari√°tu. Zjistƒõte, jak√© knihy lid√© aktu√°lnƒõ sh√°nƒõj√≠.">
<link rel="canonical" href="https://divkvariat.cz/poptavky/">

<meta property="og:title" content="Popt√°vky knih | DIVkvari√°t">
<meta property="og:description" content="Seznam popt√°vek knih od ƒçten√°≈ô≈Ø. M√°te knihu? Nab√≠dnƒõte ji.">
<meta property="og:image" content="https://media.div.cz/hero/divkvariat.webp">
<meta property="og:url" content="https://divkvariat.cz/poptavky/">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Popt√°vky knih | DIVkvari√°t">
<meta name="twitter:description" content="Knihy, kter√© u≈æivatel√© aktivnƒõ sh√°nƒõj√≠.">
<meta name="twitter:image" content="https://media.div.cz/hero/divkvariat.webp">
{% endblock %}

{% block content %}

<div class="max-w-7xl mx-auto py-10">

    <h1 class="text-3xl font-bold text-gray-800 mb-3">üìò Popt√°vky knih</h1>
    <p class="text-gray-600 mb-10">
        U≈æivatel√© zde popt√°vaj√≠ knihy, kter√© sh√°nƒõj√≠.  
        Pokud nƒõkterou m√°te, vytvo≈ôte nab√≠dku.
    </p>


<!-- üîπ ≈Ω√ÅNRY / KATEGORIE -->
{% if categories %}
<div class="mb-10">
    <h2 class="text-xl font-semibold mb-3">Kategorie</h2>

    <div class="flex flex-wrap gap-3">

        {% for g in categories %}
            <a href="?zanr={{ g.url }}"
               class="
                    px-4 py-2 rounded-lg border shadow-sm hover:bg-gray-50
                    {% if selected_genre == g.url %}
                        bg-green-100 border-green-300 text-green-800
                    {% else %}
                        bg-white text-gray-700
                    {% endif %}
                    
                    {% if forloop.counter > 2 %}
                        hidden md:inline-flex
                    {% endif %}
               ">
                {{ g.genrenamecz }}
            </a>
        {% endfor %}

    </div>

    <!-- Tlaƒç√≠tko pro odhalen√≠ v≈°ech (jen mobil) -->
    <a href="#"
       onclick="this.previousElementSibling
                    .querySelectorAll('.hidden')
                    .forEach(x => x.classList.remove('hidden')); 
                this.remove();"
       class="md:hidden mt-3 inline-block text-green-700 underline">
        Zobrazit v≈°echny
    </a>

</div>
{% endif %}



<!-- üîπ TOP KUPUJ√çC√ç -->
{% if top_buyers %}
<div class="mb-12">
    <h2 class="text-xl font-semibold mb-3">Top kupuj√≠c√≠</h2>

    <div class="flex flex-wrap gap-4">

        {% for buyer in top_buyers %}
        <a href="/uzivatel/{{ buyer.id }}/koupim-knihy/"
           class="px-4 py-3 rounded-lg border bg-white text-gray-800 shadow-sm hover:shadow-md
                  {% if forloop.counter > 2 %} hidden md:inline-flex {% endif %}">
            üõí {{ buyer.username }}
            <span class="text-sm text-gray-500 ml-1">
                ({{ buyer.total_buys }} popt√°vek)
            </span>
        </a>
        {% endfor %}

    </div>

    <a href="#"
       onclick="this.previousElementSibling.querySelectorAll('.hidden').forEach(x => x.classList.remove('hidden')); this.remove();"
       class="md:hidden mt-3 inline-block text-green-700 underline">
        Zobrazit v≈°echny
    </a>
</div>
{% endif %}



    <!-- üîπ LIST POPT√ÅVEK -->
    {% if listings %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

        {% for listing in listings %}
        <div class="bg-white border rounded-xl shadow-sm hover:shadow-lg p-4 transition flex flex-col h-full">

            <!-- Obr√°zek knihy -->
            <a href="{% url 'listing_detail_buy' listing.book.url listing.booklistingid %}">
                {% if listing.book.img == "noimg.png" %}
                    <img src="/static/img/book/book.png"
                         class="w-full h-48 sm:h-56 object-cover rounded-md mb-4">
                {% elif listing.book.img == "GoogleID" %}
                    <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1"
                         class="w-full h-48 sm:h-56 object-cover rounded-md mb-4">
                {% else %}
                    <img src="https://media.div.cz/knihy/{{ listing.book.img }}"
                         class="w-full h-48 sm:h-56 object-cover rounded-md mb-4">
                {% endif %}
            </a>

            <!-- N√°zev knihy -->
            <h3 class="text-lg font-semibold text-gray-800">
                {{ listing.book.titlecz|default:listing.book.title }}
            </h3>

            <!-- Autor -->
            <p class="text-gray-500 mb-3">{{ listing.book.author }}</p>

            <!-- Cena -->
            <p class="text-xl font-bold text-blue-600 mb-4">
                Sh√°n√≠m za {{ listing.price|floatformat:0 }} Kƒç
            </p>

            <!-- Tlaƒç√≠tko -->
            <a href="{% url 'listing_detail_buy' listing.book.url listing.booklistingid %}"
               class="mt-auto block w-full text-center py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold">
                Zobrazit popt√°vku
            </a>

            <!-- Meta -->
            <p class="text-xs text-gray-500 mt-3">
                Popt√°v√°: 
                <a class="text-green-700 hover:underline"
                   href="/uzivatel/{{ listing.user.id }}/koupim-knihy/">
                    {{ listing.user.username }}
                </a><br>
                {{ listing.createdat|date:"j. n. Y" }}
            </p>

        </div>
        {% endfor %}

    </div>

    <!-- üîπ PAGINACE -->
    <div class="flex justify-center mt-10">

        <nav class="flex items-center space-x-2">

            {% if listings.has_previous %}
                <a href="?page=1{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}"
                   class="px-3 py-2 bg-white border rounded-lg shadow-sm hover:bg-gray-50">
                    ¬´ Prvn√≠
                </a>

                <a href="?page={{ listings.previous_page_number }}{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}"
                   class="px-3 py-2 bg-white border rounded-lg shadow-sm hover:bg-gray-50">
                    ‚Äπ
                </a>
            {% endif %}

            <span class="px-4 py-2 bg-gray-100 border rounded-lg">
                Str√°nka {{ listings.number }} / {{ listings.paginator.num_pages }}
            </span>

            {% if listings.has_next %}
                <a href="?page={{ listings.next_page_number }}{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}"
                   class="px-3 py-2 bg-white border rounded-lg shadow-sm hover:bg-gray-50">
                    ‚Ä∫
                </a>

                <a href="?page={{ listings.paginator.num_pages }}{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}"
                   class="px-3 py-2 bg-white border rounded-lg shadow-sm hover:bg-gray-50">
                    Posledn√≠ ¬ª
                </a>
            {% endif %}

        </nav>

    </div>

    {% else %}
    <p class="text-center text-gray-500 mt-14">
        Moment√°lnƒõ zde nejsou ≈æ√°dn√© popt√°vky.
    </p>
    {% endif %}

</div>

{% endblock %}

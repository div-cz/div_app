{% extends "divkvariat/base.html" %}
{% load humanize %}

{% block title %}Hledání | DIVkvariát{% endblock %}

{% block content %}

<div class="page">
    <h1 class="page-title">Hledat knihu</h1>
    <!-- HLEDÁNÍ -->
    <form method="get" action="/hledat/" class="form">
        <label>
            <input
                type="text"
                name="q"
                value="{{ query }}"
                placeholder="Zadejte název knihy, autora…"
            >
        </label>
    </form>

    {% if query %}
        <p>
            Výsledky pro <strong>„{{ query }}“</strong>
        </p>
    {% endif %}

    <!-- KNIHY -->
    {% if books %}
        <section class="section">
            <h2 class="section-title">Knihy</h2>
            <div class="listing-list">
                {% for b in books %}
                    <a href="/kniha/{{ b.url }}/" class="card listing-row">

                        {% if b.img == "noimg.png" %}
                            <img src="/static/img/book/book.png">
                            {% elif b.img == "GoogleID" %}
                            <img src="https://books.google.com/books/content?id={{ b.googleid }}&printsec=frontcover&img=1&zoom=1">
                            {% else %}
                            <img src="https://media.div.cz/knihy/{{ b.img }}">
                        {% endif %}

                        <div>
                            <strong>{{ b.titlecz|default:b.title }}</strong><br>
                            {{ b.author }}
                        </div>

                    </a>
                {% endfor %}
            </div>
        </section>
    {% endif %}

    <!-- NABÍDKY / POPTÁVKY -->
    {% if listings %}
        <section class="section">
            <h2 class="section-title">Nabídky a poptávky</h2>
            <div class="listing-list">
                {% for listing in listings %}
                    <article class="card listing-row">
                        <a href="{% if listing.listingtype == 'BUY' %}
                                    {% url 'listing_detail_buy' listing.book.url listing.booklistingid %}
                                {% else %}
                                    {% url 'listing_detail_sell' listing.book.url listing.booklistingid %}
                                {% endif %}">

                            {% if listing.book.img == "noimg.png" %}
                                <img src="/static/img/book/book.png">
                                {% elif listing.book.img == "GoogleID" %}
                                <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1">
                                {% else %}
                                <img src="https://media.div.cz/knihy/{{ listing.book.img }}">
                            {% endif %}
                        </a>

                        <div>
                            <strong>
                                {{ listing.book.titlecz|default:listing.book.title }}
                            </strong><br>
                            {{ listing.book.author }}
                        </div>

                        <div class="listing-price">
                            {% if listing.listingtype == 'BUY' %}
                                Koupím za {{ listing.price|floatformat:0 }} Kč
                                {% elif listing.listingtype == 'GIVE' %}
                                Daruji
                                {% else %}
                                {{ listing.price|floatformat:0 }} Kč
                            {% endif %}
                        </div>

                        <div class="listing-meta">
                            Přidal {{ listing.user.username }} •
                            {{ listing.createdat|date:"j. n. Y" }}
                        </div>

                    </article>
                {% endfor %}
            </div>

            <!-- PAGINACE -->
            <div class="pagination">
                {% if listings.has_previous %}
                    <a href="?q={{ query }}&page=1">« První</a>
                    <a href="?q={{ query }}&page={{ listings.previous_page_number }}">‹</a>
                {% endif %}

                <span>
                    Stránka {{ listings.number }} / {{ listings.paginator.num_pages }}
                </span>

                {% if listings.has_next %}
                    <a href="?q={{ query }}&page={{ listings.next_page_number }}">›</a>
                    <a href="?q={{ query }}&page={{ listings.paginator.num_pages }}">Poslední »</a>
                {% endif %}
            </div>

        </section>
    {% endif %}

    {% if query and not books and not listings %}
        <p>
            Pro tento výraz jsme nic nenašli.
        </p>
    {% endif %}
</div>

{% endblock %}

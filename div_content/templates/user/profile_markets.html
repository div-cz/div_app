{% extends "user/base.html" %}

{% load i18n %}

{% block title %}Profil {{ profile_user.username }} {% endblock title %}

{% block h1 %}{{ profile_user.username }}{% endblock h1 %}
{% block text_muted %} na DIV.cz{% endblock text_muted %}

{% block meta %}

<style>
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }

    .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        z-index: 1000;
        border-radius: 10px;
        width: 50%;
    }

    .rating-comment-container {
        position: relative;
        display: inline-block;
        cursor: pointer;
    }

    .comment-popup {
        visibility: hidden;
        width: 250px;
        background-color: #f9f9f9;
        color: #333;
        text-align: left;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1000;
        bottom: 125%;
        left: 50%;
        margin-left: -125px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        opacity: 0;
        transition: opacity 0.3s;
    }

    .rating-comment-container:hover .comment-popup {
        visibility: visible;
        opacity: 1;
    }

    .comment-popup::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #f9f9f9 transparent transparent transparent;
    }

    .rating-header-row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 2fr 1fr 1.5fr;
    }

    @media (max-width: 768px) {
        .rating-header-row {
            grid-template-columns: 1fr 1fr 2fr 1fr 1.5fr;
        }
        .hide-on-mobile {
            display: none;
        }
    }

    .nav-tabs-item a.active,
    .tab.active {
        background-color: #ca7620;
    }

    .nav-tabs-link {
        color: #ca7620;
    }

    .nav-tabs-link:is(.dark *) {
        color: #ca7620;
    }
</style>

{% endblock %}

{% block content %}

<div style="margin-top: 1.25rem;">
    <!-- Sekce záložek pro filmy, knihy, hry, statistiky -->
    <ul class="tab-profil">
        <li class="tab {% if active_tab == 'filmy' %}active{% endif %}">
            <span>&#127902;</span>
            <a class="movies" href="{% url 'profile_movies_section' profile_user.id %}">Filmy</a>
        </li>
        <li class="tab {% if active_tab == 'serialy' %}active{% endif %}">
            <span>&#128250;</ispan>
            <a class="movies" href="{% url 'profile_series_section' profile_user.id %}">Seriály</a>
        </li>
        <li class="tab {% if active_tab == 'knihy' %}active{% endif %}">
            <span>&#128214;</span>
            <a class="books" href="{% url 'profile_books_section' profile_user.id %}">Knihy</a>
        </li>
        <li class="tab {% if active_tab == 'hry' %}active{% endif %}">
            <span>&#127918;</span>
            <a class="games" href="{% url 'profile_games_section' profile_user.id %}">Hry</a>
        </li>
        <li class="tab {% if active_tab == 'statistiky' %}active{% endif %}">
            <span>&#11088;</span>
            <a class="stats" href="{% url 'profile_stats_section' profile_user.id %}">Statistiky</a>
        </li>
        <li class="tab {% if active_tab == 'vitrina' %}active{% endif %}">
            <span>&#127942;</span> 
            <a class="badges" href="{% url 'profile_show_case' profile_user.id %}">Vitrína</a>
        </li>
        <li class="tab {% if active_tab == 'obchod' %}active{% endif %}">
            <span>&#128717;</span> 
            <a class="shop" href="{% url 'profile_eshop_section' profile_user.id %}">Obchod</a>
        </li>
        <li class="tab {% if active_tab == 'komunita' %}active{% endif %}" >
            <span>&#128101;</span>
            <a class="community" href="{% url 'profile_community_section' profile_user.id %}">Má komunita</a>
        </li>

        <!-- Indikátor pozadí -->
        <div class="background"></div>

    </ul>

    <!-- Podkategorie záložek (e-knihy, audio atd.) -->
    <div class="row" style="margin-top: 1.25rem;">
        <ul class="nav nav-tabs">
            <li class="nav-tabs-item">
                <a class="nav-tabs-link active" href="#" id="tab-eknihy" onclick="updateNavTabSelector(this)">E-knihy</a>
            </li>
            <li class="nav-tabs-item">
                <a class="nav-tabs-link" href="#" id="tab-audioknihy" onclick="updateNavTabSelector(this)">Audioknihy</a>
            </li>
            <li class="nav-tabs-item">
                <a class="nav-tabs-link" href="#" id="tab-burza-knih" onclick="updateNavTabSelector(this)">Burza knih</a>
            </li>
            <li class="nav-tabs-item">
                <a class="nav-tabs-link" href="#" id="tab-burza-her" onclick="updateNavTabSelector(this)">Burza her</a>
            </li>
            <li class="nav-tabs-item">
                <a class="nav-tabs-link" href="#" id="tab-hodnoceni" onclick="updateNavTabSelector(this)">Hodnocení</a>
            </li>

            <!-- Indikátor pozadí -->
            <div class="background"></div>
        </ul>
        
        <div class="tab-content">
            <!-- Tab E-knihy -->
            <div id="eknihy" class="tab-show active {% if category == 'e-knihy' %}active{% endif %}">
                <div class="tab-content-item">
                    <h3 class="card-title after-h3">Zakoupené E-knihy</h3>
                    {% if purchased_ebooks %}
                        <div class="shop-list">
                            {% for p in purchased_ebooks %}
                                <div class="shop-card">
                                    <div>
                                        <img src="{% if p.book.img and p.book.img != 'noimg.png' %}https://media.div.cz/knihy/{{ p.book.img }}{% else %}https://div.cz/static/img/book/book.png{% endif %}" alt="{{ p.book.titlecz|default:p.book.title }}" style="max-width: 150px;">
                                    </div>
                                    <div class="rating-summary-list">
                                        <div class="shop-card-info">
                                            <div class="shop-card-row">
                                                <a class="books" href="/kniha/{{ p.book.url }}">{{ p.book.titlecz|default:p.book.title }}</a>
                                                ({{ p.book.year|default:"-" }})
                                            </div>
                                            <div class="shop-card-row">
                                                {% if p.book.bookauthor_set.all %}
                                                    {% for ba in p.book.bookauthor_set.all %}
                                                        {{ ba.author.firstname }} {{ ba.author.lastname }}{% if not forloop.last %}, {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                            </div>
                                            <div class="shop-card-row">{{ p.paymentdate|date:"j. n. Y H:i" }}</div>
                                            <div class="shop-card-row">{{ p.price|floatformat:0 }} Kč</div>
                                            <div class="shop-card-row">formát: {{ p.format|upper }}</div>
                                            <div style="shop-card-row">faktura: <a href="" class="w-full mt-2 text-center" title="Stáhnout fakturu">stáhnout (PDF)</a><br>v přípravě</div><!--% url 'download_invoice' p.purchaseid %-->
                                        </div>
                                        <div class="shop-card-actions">
                                            {% if p.isbn %}
                                                <a href="{% url 'download_ebook' p.isbn p.format %}" class="btn add-book">Stáhnout</a>
                                                <a href="/kniha/{{ p.book.url }}" class="btn add-book" title="Odeslat do čtečky">Odeslat</a>
                                            {% else %}
                                                <span style="color:red;">Chybí ISBN pro tento formát</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <!-- PAGINÁTOR -->
                        <div class="pagination">
                            <span class="step-links">
                            {% if purchased_ebooks.has_previous %}
                                <a class="first-page" href="?page=1">&laquo; První</a>
                                <a href="?page={{ purchased_ebooks.previous_page_number }}">Předchozí</a>
                            {% endif %}

                                <span class="current-page">
                                    {{ purchased_ebooks.number }} / {{ purchased_ebooks.paginator.num_pages }}
                                </span>

                            {% if purchased_ebooks.has_next %}
                                <a href="?page={{ purchased_ebooks.next_page_number }}">Další</a>
                                <a class="last-page" href="?page={{ purchased_ebooks.paginator.num_pages }}">Poslední &raquo;</a>
                            {% endif %}
                            </span>
                        </div>

                        {% else %}
                        <p style="padding: .75rem;">žádné zakoupené E-knihy</p>
                    {% endif %}
                </div>                       
            </div>

            <!-- Tab Audioknihy -->
            <div id="audioknihy" class="tab-show {% if category == 'audioknihy' %}active{% endif %}">
                <div class="tab-content-item">
                    <h3 class="card-title after-h3">Zakoupené Audioknihy</h3>
                    {% if purchased_audiobooks %}
                        <div class="shop-list">
                            {% for a in purchased_audiobooks %}
                                <div class="shop-card">
                                    <div>
                                        <img src="{% if a.book.img and a.book.img != 'noimg.png' %}/static/kniha/{{ a.book.img }}{% else %}https://div.cz/static/img/book/book.png{% endif %}" alt="{{ a.book.titlecz|default:a.book.title }}" style="max-width: 150px;">
                                    </div>
                                    <div class="rating-summary-list">
                                        <div class="shop-card-info">
                                            <div class="shop-card-row">
                                                <a class="books" href="/kniha/{{ a.book.url }}">{{ a.book.titlecz|default:a.book.title }}</a>
                                                ({{ a.book.year|default:"-" }})
                                            </div>
                                            <div class="shop-card-row">
                                                {% if a.book.bookauthor_set.all %}
                                                    {% for ba in a.book.bookauthor_set.all %}
                                                        {{ ba.author.firstname }} {{ ba.author.lastname }}{% if not forloop.last %}, {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                            </div>
                                            <div class="shop-card-row">{{ a.paymentdate|date:"j. n. Y H:i" }}</div>
                                            <div class="shop-card-row">{{ a.price|floatformat:0 }} Kč</div>
                                            <div class="shop-card-row">formát: AUDIO</div>
                                        </div>
                                        <div class="shop-card-actions">
                                            {% if a.download_url %}
                                                <a href="{{ a.download_url }}" class="btn add-book">Stáhnout</a>
                                            {% endif %}
                                            {# případně další akce #}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <!-- PAGINÁTOR -->
                        {% if purchased_audiobooks.paginator.num_pages > 1 %}
                            <div class="pagination">
                                <span class="step-links">
                                {% if purchased_audiobooks.has_previous %}
                                    <a class="first-page" href="?audio_page=1#audioknihy">&laquo; První</a>
                                    <a href="?audio_page={{ purchased_audiobooks.previous_page_number }}#audioknihy">Předchozí</a>
                                {% endif %}

                                    <span class="current-page">
                                        {{ purchased_audiobooks.number }} / {{ purchased_audiobooks.paginator.num_pages }}
                                    </span>

                                {% if purchased_audiobooks.has_next %}
                                    <a href="?audio_page={{ purchased_audiobooks.next_page_number }}#audioknihy">Další</a>
                                    <a class="last-page" href="?audio_page={{ purchased_audiobooks.paginator.num_pages }}#audioknihy">Poslední &raquo;</a>
                                {% endif %}
                                </span>
                            </div>
                        {% endif %}

                        {% else %}
                        <p style="padding: .75rem;">žádné zakoupené Audioknihy</p>
                    {% endif %}
                </div>
            </div>

            <!-- Tab Burza knih -->
            <div id="burza-knih" class="tab-show {% if category == 'burza-knih' %}active{% endif %}">
                <div class="tab-content-item">
                    <h3 class="card-title after-h3">Zakoupené knihy (z burzy - divkvariát)</h3>
                    <div class="shop-list">
                        {% if burza_bought %}
                            {% for b in burza_bought %}
                                <div class="shop-card">
                                    <img src="{% if b.book.img and b.book.img != 'noimg.png' %}https://media.div.cz/knihy/{{ b.book.img }}{% else %}https://div.cz/static/img/book/book.png{% endif %}" alt="{{ b.book.titlecz|default:b.book.title }}" style="max-width: 150px;">
                                    <div class="rating-summary-list">
                                        <div class="shop-card-row">
                                            <a class="books" href="/kniha/{{ b.book.url }}">{{ b.book.titlecz|default:b.book.title }}</a> 
                                            ({{ b.book.year|default:"-" }})
                                        </div>
                                        <div class="shop-card-row">
                                            {% for ba in b.book.bookauthor_set.all %}
                                                {{ ba.author.firstname }} {{ ba.author.lastname }}
                                                {% if not forloop.last %}, 
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <div class="shop-card-row">{{ b.completedat|date:"j. n. Y H:i" }}</div>
                                        <div class="shop-card-row">Cena: {{ b.price|floatformat:0 }} Kč</div>

                                        <div class="shop-card-footer">
                                            <div>Prodejce: 
                                                <a href="/uzivatel/{{ b.user.id }}/">{{ b.user.username }}</a>
                                            </div>

                                            <div>
                                                <!-- Popup pro recenzi viz původní blok – stejný jako ve tvém zadání -->
                                                {% if user.is_authenticated %}
                                                    <div class="overlay hidden"></div>
                                                    <div class="popup hidden">
                                                        <div class="flex">
                                                            <h3>Ohodnoť uživatele a pošli recenzi</h3>
                                                            <button style="margin: 0 0 10px auto; font-size: 25px;" id="closePopup"><i class="fa-solid fa-xmark"></i></button>
                                                        </div>
                                                        <form id="reviewForm">
                                                            <div class="rating-type">
                                                                <label><input type="radio" name="ratingType" value="positive">Pozitivní</label>
                                                                <label><input type="radio" name="ratingType" value="neutral">Neutrální</label>
                                                                <label><input type="radio" name="ratingType" value="negative">Negativní</label>
                                                            </div>
                                                            <div class="stars" style="font-size: 25px; margin-bottom: 15px;">
                                                                <span class="star" data-value="1">&#9733;</span>
                                                                <span class="star" data-value="2">&#9733;</span>
                                                                <span class="star" data-value="3">&#9733;</span>
                                                                <span class="star" data-value="4">&#9733;</span>
                                                                <span class="star" data-value="5">&#9733;</span>
                                                            </div>
                                                            <textarea id="reviewText" placeholder="Napiš svou recenzi..." rows="5" style="width: 100%; padding: 10px;"></textarea>
                                                            
                                                            <button type="submit" class="btn add-book">Odeslat recenzi</button>
                                                        </form>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}

                            {% else %}
                                <p style="padding: .75rem;">žádné zakoupené knihy z burzy</p>
                        {% endif %}
                    </div>

                    <!-- PAGINÁTOR -->
                    {% if burza_bought.paginator.num_pages > 1 %}
                        <div class="pagination">
                            <span class="step-links">
                            {% if burza_bought.has_previous %}
                                <a class="first-page" href="?burza_bought_page=1#burza-knih">&laquo; První</a>
                                <a href="?burza_bought_page={{ burza_bought.previous_page_number }}#burza-knih">Předchozí</a>
                            {% endif %}

                                <span class="current-page">
                                    {{ burza_bought.number }} / {{ burza_bought.paginator.num_pages }}
                                </span>

                            {% if burza_bought.has_next %}
                                <a href="?burza_bought_page={{ burza_bought.next_page_number }}#burza-knih">Další</a>
                                <a class="last-page" href="?burza_bought_page={{ burza_bought.paginator.num_pages }}#burza-knih">Poslední &raquo;</a>
                            {% endif %}
                            </span>
                        </div>
                    {% endif %}
                </div>

                <div class="tab-content-item">
                    <h3 class="card-title after-h3">Prodané knihy (z burzy - divkvariát)</h3>
                    <div class="shop-list">
                        {% if burza_sold %}
                            {% for s in burza_sold %}
                                <div class="shop-card">
                                    <img src="{% if s.book.img and s.book.img != 'noimg.png' %}https://media.div.cz/knihy/{{ s.book.img }}{% else %}https://div.cz/static/img/book/book.png{% endif %}" alt="{{ s.book.titlecz|default:s.book.title }}" style="max-width: 150px;">

                                    <div class="rating-summary-list">
                                        <div class="shop-card-row">
                                            <a class="books" href="/kniha/{{ s.book.url }}">{{ s.book.titlecz|default:s.book.title }}</a> ({{ s.book.year|default:"-" }})
                                        </div>
                                        <div class="shop-card-row">
                                            {% for ba in s.book.bookauthor_set.all %}
                                                {{ ba.author.firstname }} {{ ba.author.lastname }}{% if not forloop.last %}, {% endif %}
                                            {% endfor %}
                                        </div>
                                        <div class="shop-card-row">{{ s.completedat|date:"j. n. Y H:i" }}</div>
                                        <div class="shop-card-row">Cena: {{ s.price|floatformat:0 }} Kč</div>

                                        <div class="shop-card-footer">
                                            <div>
                                                {% if s.buyer %}
                                                    Kupující: <a href="/uzivatel/{{ s.buyer.id }}/">{{ s.buyer.username }}</a>
                                                {% else %}
                                                    <span>—</span>
                                                {% endif %}
                                            </div>

                                            <div>
                                                <!-- Popup stejný jako výše -->
                                                {% if user.is_authenticated %}
                                                    <div class="overlay hidden"></div>
                                                    <div class="popup hidden">
                                                        <div class="flex">
                                                            <h3>Ohodnoť uživatele a pošli recenzi</h3>
                                                            <button class="btn add-book" id="closePopup"><i class="fa-solid fa-xmark"></i></button>
                                                        </div>
                                                        <form id="reviewForm">
                                                            <div class="rating-type">
                                                                <label><input type="radio" name="ratingType" value="positive">Pozitivní</label>
                                                                <label><input type="radio" name="ratingType" value="neutral">Neutrální</label>
                                                                <label><input type="radio" name="ratingType" value="negative">Negativní</label>
                                                            </div>
                                                            <div class="stars" style="font-size: 25px; margin-bottom: 15px;">
                                                                <span class="star" data-value="1">&#9733;</span>
                                                                <span class="star" data-value="2">&#9733;</span>
                                                                <span class="star" data-value="3">&#9733;</span>
                                                                <span class="star" data-value="4">&#9733;</span>
                                                                <span class="star" data-value="5">&#9733;</span>
                                                            </div>
                                                            <textarea id="reviewText" placeholder="Napiš svou recenzi..." rows="5" style="width: 100%; padding: 10px;"></textarea>
                                                            
                                                            <button type="submit" class="btn add-book">Odeslat recenzi</button>
                                                        </form>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}

                            {% else %}
                            <p style="padding: .75rem;">žádné prodané knihy z burzy</p>
                        {% endif %}
                    </div>

                    <!-- PAGINÁTOR -->
                    {% if burza_sold.paginator.num_pages > 1 %}
                        <div class="pagination">
                            <span class="step-links">
                            {% if burza_sold.has_previous %}
                                <a class="first-page" href="?burza_sold_page=1#burza-knih">&laquo; První</a>
                                <a href="?burza_sold_page={{ burza_sold.previous_page_number }}#burza-knih">Předchozí</a>
                            {% endif %}

                                <span class="current-page">
                                    {{ burza_sold.number }} / {{ burza_sold.paginator.num_pages }}
                                </span>

                            {% if burza_sold.has_next %}
                                <a href="?burza_sold_page={{ burza_sold.next_page_number }}#burza-knih">Další</a>
                                <a class="last-page" href="?burza_sold_page={{ burza_sold.paginator.num_pages }}#burza-knih">Poslední &raquo;</a>
                            {% endif %}
                            </span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Tab Burza her -->
            <div id="burza-her" class="tab-show {% if category == 'burza-her' %}active{% endif %}">
                <div class="tab-content-item">
                    <h3 class="card-title after-h3">Zakoupené hry (V přípravě)</h3>
                    
                    <div class="shop-list">
                        <div class="shop-card-flex">
                            <div>
                                <img src="https://div.cz/static/img/book/book.png" alt="Bez obrazku" style="max-width: 150px;">
                            </div>

                            <div class="rating-summary-list">
                                <div class="shop-card-info">
                                    <div class="shop-card-row">
                                        <a class="games" href="">
                                            Název hry
                                        </a> (rok)
                                    </div>

                                    <div class="shop-card-row">
                                        <a class="games" href="">
                                            vydavatel
                                        </a>
                                    </div>

                                    <div class="shop-card-row">datum koupě</div> <!-- datum -->
                                    <div class="shop-card-row">cena</div>

                                    <div class="shop-card-footer">
                                        <div>
                                            <a href="">prodejce</a>
                                        </div>

                                        <div>
                                            <!-- Popup okno -->
                                            {% if user.is_authenticated %}
                                                <div class="overlay hidden"></div>
                                                <div class="popup hidden">
                                                    <div class="flex">
                                                        <h3>Ohodnoť uživatele a pošli recenzi</h3>
                                                        <button class="btn add-book" id="closePopup"><i class="fa-solid fa-xmark"></i></button>
                                                    </div>

                                                    <!-- Formulář pro recenzi -->
                                                    <form id="reviewForm">
                                                        <!-- Radio buttons pro typ hodnocení -->
                                                        <div class="rating-type">
                                                            <label>
                                                                <input type="radio" name="ratingType" value="positive">Pozitivní
                                                            </label>
                                                            <label>
                                                                <input type="radio" name="ratingType" value="neutral">Neutrální
                                                            </label>
                                                            <label>
                                                                <input type="radio" name="ratingType" value="negative">Negativní
                                                            </label>
                                                        </div>

                                                        <!-- Hvězdičkové hodnocení -->
                                                        <div class="stars" style="font-size: 25px; margin-bottom: 15px;">
                                                            <span class="star" data-value="1">&#9733;</span>
                                                            <span class="star" data-value="2">&#9733;</span>
                                                            <span class="star" data-value="3">&#9733;</span>
                                                            <span class="star" data-value="4">&#9733;</span>
                                                            <span class="star" data-value="5">&#9733;</span>
                                                        </div>

                                                        <!-- Textové pole pro recenzi -->
                                                        <textarea id="reviewText" placeholder="Napiš svou recenzi..." rows="5" style="width: 100%; padding: 10px;"></textarea> <!-- možná omezit na 100 znaků? -->
                                                        
                                                        <button type="submit" class="btn add-book">Odeslat recenzi</button>
                                                    </form>
                                                </div>
                                            {% endif %}

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="shop-card-flex">
                            <img src="https://div.cz/static/img/book/book.png" alt="Bez obrazku" style="max-width: 150px;">

                            <div class="rating-summary-list">
                                <div class="shop-card-info">
                                    <div class="shop-card-row">
                                        <a class="games" href="">
                                            Název hry
                                        </a> (rok)
                                    </div>

                                    <div class="shop-card-row">
                                        <a class="games" href="">
                                            Autor
                                        </a>
                                    </div>

                                    <div class="shop-card-row">datum koupě</div> <!-- datum -->
                                    <div class="shop-card-row">cena</div>

                                    <div class="shop-card-footer">
                                        <div>
                                            <a href="">prodejce</a>
                                        </div>

                                        <div>
                                            <!-- Popup okno -->
                                            {% if user.is_authenticated %}
                                                <div class="overlay hidden"></div>
                                                <div class="popup hidden">
                                                    <div class="flex">
                                                        <h3>Ohodnoť uživatele a pošli recenzi</h3>
                                                        <button class="btn add-book" style="margin: 0 0 10px auto; font-size: 25px;" id="closePopup"><i class="fa-solid fa-xmark"></i></button>
                                                    </div>

                                                    <!-- Formulář pro recenzi -->
                                                    <form id="reviewForm">
                                                        <!-- Radio buttons pro typ hodnocení -->
                                                        <div class="rating-type">
                                                            <label>
                                                                <input type="radio" name="ratingType" value="positive">Pozitivní
                                                            </label>
                                                            <label>
                                                                <input type="radio" name="ratingType" value="neutral">Neutrální
                                                            </label>
                                                            <label>
                                                                <input type="radio" name="ratingType" value="negative">Negativní
                                                            </label>
                                                        </div>

                                                        <!-- Hvězdičkové hodnocení -->
                                                        <div class="stars" style="font-size: 25px; margin-bottom: 15px;">
                                                            <span class="star" data-value="1">&#9733;</span>
                                                            <span class="star" data-value="2">&#9733;</span>
                                                            <span class="star" data-value="3">&#9733;</span>
                                                            <span class="star" data-value="4">&#9733;</span>
                                                            <span class="star" data-value="5">&#9733;</span>
                                                        </div>

                                                        <!-- Textové pole pro recenzi -->
                                                        <textarea id="reviewText" placeholder="Napiš svou recenzi..." rows="5" style="width: 100%; padding: 10px;"></textarea> <!-- možná omezit na 100 znaků? -->
                                                        
                                                        <button type="submit" class="btn add-book">Odeslat recenzi</button>
                                                    </form>
                                                </div>
                                            {% endif %}

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>      

                    <!-- PAGINÁTOR -->
                    <div class="pagination">
                        <span class="step-links">
                            
                                <a class="first-page" href="">&laquo; První</a>
                                <a href="">Předchozí</a>
                            
                            
                            <span class="current-page">
                            Stránka  / 
                            </span>
                            
                                <a class="last-page" href="">Další</a>
                                <a href="">Poslední &raquo;</a>
                            
                        </span>
                    </div> 
                    
                    <p style="padding: .75rem;">žádné zakoupené hry</p>
                </div>    

                <div class="tab-content-item">
                    <div id="">
                        <h3 class="card-title after-h3">Prodané hry</h3>
                        
                        <div class="shop-list">
                            <div class="shop-card-flex">
                                <img src="https://div.cz/static/img/book/book.png" alt="Bez obrazku" style="max-width: 150px;">
        
                                <div class="rating-summary-list">
                                    <div class="shop-card-info">
                                        <div class="shop-card-row">
                                            <a class="games" href="">
                                                Název hry
                                            </a> (rok)
                                        </div>
        
                                        <div class="shop-card-row">
                                            <a class="games" href="">
                                                Autor
                                            </a>
                                        </div>
        
                                        <div class="shop-card-row">datum prodeje</div> <!-- datum -->
                                        <div class="shop-card-row">cena</div>
                                        <div class="shop-card-footer">
                                            <div>
                                                <a href="">kupující</a>
                                            </div>

                                            <div>
                                                <!-- Popup okno -->
                                                {% if user.is_authenticated %}
                                                    <div class="overlay hidden"></div>
                                                    <div class="popup hidden">
                                                        <div class="flex">
                                                            <h3>Ohodnoť uživatele a pošli recenzi</h3>
                                                            <button class="btn add-book" id="closePopup"><i class="fa-solid fa-xmark"></i></button>
                                                        </div>

                                                        <!-- Formulář pro recenzi -->
                                                        <form id="reviewForm">
                                                            <!-- Radio buttons pro typ hodnocení -->
                                                            <div class="rating-type">
                                                                <label>
                                                                    <input type="radio" name="ratingType" value="positive">Pozitivní
                                                                </label>
                                                                <label>
                                                                    <input type="radio" name="ratingType" value="neutral">Neutrální
                                                                </label>
                                                                <label>
                                                                    <input type="radio" name="ratingType" value="negative">Negativní
                                                                </label>
                                                            </div>

                                                            <!-- Hvězdičkové hodnocení -->
                                                            <div class="stars" style="font-size: 25px; margin-bottom: 15px;">
                                                                <span class="star" data-value="1">&#9733;</span>
                                                                <span class="star" data-value="2">&#9733;</span>
                                                                <span class="star" data-value="3">&#9733;</span>
                                                                <span class="star" data-value="4">&#9733;</span>
                                                                <span class="star" data-value="5">&#9733;</span>
                                                            </div>

                                                            <!-- Textové pole pro recenzi -->
                                                            <textarea id="reviewText" placeholder="Napiš svou recenzi..." rows="5" style="width: 100%; padding: 10px;"></textarea> <!-- možná omezit na 100 znaků? -->
                                                            
                                                            <button type="submit" class="btn add-book">Odeslat recenzi</button>
                                                        </form>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="shop-card-flex">
                                <img src="https://div.cz/static/img/book/book.png" alt="Bez obrazku" style="max-width: 150px;">
        
                                <div class="rating-summary-list">
                                    <div class="shop-card-info">
                                        <div class="shop-card-row">
                                            <a class="games" href="">
                                                Název hry
                                            </a> (rok)
                                        </div>
        
                                        <div class="shop-card-row">
                                            <a class="games" href="">
                                                vydavatel
                                            </a>
                                        </div>
        
                                        <div class="shop-card-row">datum prodeje</div> <!-- datum -->
                                        <div class="shop-card-row">cena</div>
                                        <div class="shop-card-footer">
                                            <div>
                                                <a href="">kupující</a>
                                            </div>

                                            <div>
                                                <!-- Popup okno -->
                                                {% if user.is_authenticated %}
                                                    <div class="overlay hidden"></div>
                                                    <div class="popup hidden">
                                                        <div class="flex">
                                                            <h3>Ohodnoť uživatele a pošli recenzi</h3>
                                                            <button class="btn add-book" id="closePopup"><i class="fa-solid fa-xmark"></i></button>
                                                        </div>

                                                        <!-- Formulář pro recenzi -->
                                                        <form id="reviewForm">
                                                            <!-- Radio buttons pro typ hodnocení -->
                                                            <div class="rating-type">
                                                                <label>
                                                                    <input type="radio" name="ratingType" value="positive">Pozitivní
                                                                </label>
                                                                <label>
                                                                    <input type="radio" name="ratingType" value="neutral">Neutrální
                                                                </label>
                                                                <label>
                                                                    <input type="radio" name="ratingType" value="negative">Negativní
                                                                </label>
                                                            </div>

                                                            <!-- Hvězdičkové hodnocení -->
                                                            <div class="stars" style="font-size: 25px; margin-bottom: 15px;">
                                                                <span class="star" data-value="1">&#9733;</span>
                                                                <span class="star" data-value="2">&#9733;</span>
                                                                <span class="star" data-value="3">&#9733;</span>
                                                                <span class="star" data-value="4">&#9733;</span>
                                                                <span class="star" data-value="5">&#9733;</span>
                                                            </div>

                                                            <!-- Textové pole pro recenzi -->
                                                            <textarea id="reviewText" placeholder="Napiš svou recenzi..." rows="5" style="width: 100%; padding: 10px;"></textarea> <!-- možná omezit na 100 znaků? -->
                                                            
                                                            <button type="submit" class="btn add-book">Odeslat recenzi</button>
                                                        </form>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>

                        <!-- PAGINÁTOR -->
                        <div class="pagination">
                            <span class="step-links">
        
                                    <a class="first-page" href="">&laquo; První</a>
                                    <a href="">Předchozí</a>
                                
                                <span class="current-page">
                                    / 
                                </span>
                                
                                    <a class="last-page" href="">Další</a>
                                    <a href="">Poslední &raquo;</a>
                                
                            </span>
                        </div>
                        
                        <p style="padding: .75rem;">žádné prodané hry</p>
                        
                    </div>
                </div>
            </div>

            <!-- Tab Hodnocení -->
            <div id="hodnoceni" class="tab-show {% if category == 'hodnoceni' %}active{% endif %}">
                <div class="tab-content-item">
                    <h3 class="card-title after-h3">Celkové hodnocení prodávajícího </h3>
                    {% if avg_seller_rating %}
                        <div class="shop-list">
                            <div class="table">
                                <div class="rating-header-row">
                                    <div class="text-center font-bold p-1" style="border-right: 1px solid #fffefe;">{{ avg_seller_rating|floatformat:1 }}/5</div>
                                    <div class="">
                                        {% for i in "12345"|make_list %}
                                            {% if forloop.counter <= avg_seller_rating %}★{% else %}☆{% endif %}
                                        {% endfor %}
                                    </div>
                                    <span style="margin-left: 0.5rem;">({{ seller_ratings_count }} hodnocení)</span>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    {% if avg_buyer_rating %}
                    <h3 class="card-title after-h3"> Celkové hodnocení kupujícího </h3>
                    <div class="shop-list">
                        <div class="table">
                            <div class="rating-header-row">
                                <div class="text-center font-bold p-1" style="border-right: 1px solid #fffefe;">{{ avg_buyer_rating|floatformat:1 }}/5</div>
                                <div class="">
                                    {% for i in "12345"|make_list %}
                                        {% if forloop.counter <= avg_buyer_rating %}★{% else %}☆{% endif %}
                                    {% endfor %}
                                </div>
                                <span style="margin-left: 0.5rem;">({{ buyer_ratings_count }} hodnocení)</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="filter-options">
                        <label for="sort_by">Seřadit podle:</label>
                        <select name="sort_by" id="sort_by" style="color: black;" onchange="window.location.href = this.value;">
                            <option value="{% url 'profile_eshop_section' user_id=profile_user.id %}?sort=newest#hodnoceni" {% if current_sort == 'newest' %}selected{% endif %}>Nejnovější</option>
                            <option value="{% url 'profile_eshop_section' user_id=profile_user.id %}?sort=highest#hodnoceni" {% if current_sort == 'highest' %}selected{% endif %}>Nejvyšší hodnocení</option>
                            <option value="{% url 'profile_eshop_section' user_id=profile_user.id %}?sort=lowest#hodnoceni" {% if current_sort == 'lowest' %}selected{% endif %}>Nejnižší hodnocení</option>
                            <option value="{% url 'profile_eshop_section' user_id=profile_user.id %}?sort=oldest#hodnoceni" {% if current_sort == 'oldest' %}selected{% endif %}>Nejstarší</option>
                        </select>
                    </div>

                    <div style="clear: both;"></div>
                    <div class="">
                        <div class="">
                            <div class="rating-header-row">
                                <div class="rating-header-cell">Datum</div>
                                <div class="rating-header-cell">Hodnocení</div>
                                <div class="rating-header-cell">Hodnocen</div>
                                <div class="rating-header-cell">Komentář</div>
                                <div class="rating-header-cell">Hodnotil</div>
                            </div>

                            {% if ratings_page_obj %}
                                {% for rating_data in ratings_page_obj %}
                                    <div class="rating-header-row">
                                        <div class="rating-cell">{{ rating_data.created_at|default:"-" }}</div>
                                        <div class="rating-cell">
                                            {% for i in "12345"|make_list %}
                                                {% if forloop.counter <= rating_data.value %}★{% else %}☆{% endif %}
                                            {% endfor %}
                                        </div>
                                        <div class="rating-cell">{{ rating_data.type }}</div>
                                        <div class="rating-cell">
                                            {% if rating_data.comment %}
                                                {% if rating_data.comment|length > 30 %}
                                                    <div class="rating-comment-container">
                                                        {{ rating_data.comment|truncatechars:30 }}
                                                        <div class="comment-popup">
                                                            <p>{{ rating_data.comment }}</p>
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    {{ rating_data.comment }}
                                                {% endif %}

                                                {% else %}
                                                Bez komentáře.
                                            {% endif %}
                                        </div>
                                        <div class="rating-cell"> <a href="{% url 'myuser_detail' user_id=rating_data.rater.id %}">{% if rating_data.rater %}{{ rating_data.rater }}</a>{% else %}Anonymní{% endif %}</div>
                                    </div>
                                {% endfor %}

                                {% else %}

                                <div class="rating-header-row">
                                    <div>Tento uživatel zatím neobdržel žádná jednotlivá hodnocení.</div>
                                </div>
                            {% endif %}
                        </div>

                            <!--<div class="w-full">
                                <div class="grid border rating-header-row">
                                    <div class="text-center p-1" style="border-right: 1px solid #c0c0c0;">datum</div>
                                    <div style="border-right: 1px solid #c0c0c0;">test<!--negativní--> <!--<span>1 hvězd</span></div>--> <!-- pozitivní / neutrální / negativní --><!--
                                    <div>zanechaný komentář od kupujícího</div>
                                </div>
                            </div>-->

                            <!--<div class="w-full">
                                <div class="grid border rating-header-row">
                                    <div class="text-center p-1" style="border-right: 1px solid #c0c0c0;">datum</div>
                                    <div style="border-right: 1px solid #c0c0c0;">pozitivní <span>5 hvězd</span></div>--> <!-- pozitivní / neutrální / negativní --><!--
                                    <div>další zanechaný komentář od kupujícího</div>
                                </div>
                            </div>-->
                        </div>

                        <!-- PAGINÁTOR -->
                        {% if ratings_page_obj.paginator.num_pages > 1 %}
                            <div class="pagination">
                                <span class="step-links">
                                    {% if ratings_page_obj.has_previous %}
                                        <a class="first-page" href="{% url 'profile_eshop_section' user_id=profile_user.id %}?page=1&sort={{ current_sort }}#hodnoceni">&laquo; První</a>
                                        <a href="{% url 'profile_eshop_section' user_id=profile_user.id %}?page={{ ratings_page_obj.previous_page_number }}&sort={{ current_sort }}#hodnoceni">Předchozí</a>
                                    {% endif %}

                                    <span class="current-page">
                                        Stránka {{ ratings_page_obj.number }} / {{ ratings_page_obj.paginator.num_pages }}
                                    </span>

                                    {% if ratings_page_obj.has_next %}
                                        <a href="{% url 'profile_eshop_section' user_id=profile_user.id %}?page={{ ratings_page_obj.next_page_number }}&sort={{ current_sort }}#hodnoceni">Další</a>
                                        <a class="last-page" href="{% url 'profile_eshop_section' user_id=profile_user.id %}?page={{ ratings_page_obj.paginator.num_pages }}&sort={{ current_sort }}#hodnoceni">Poslední &raquo;</a>
                                    {% endif %}
                                </span>
                            </div>
                        {% endif %}                    
                    </div>
                </div>
            </div>
    </div>
</div>

{% endblock content %}

{% block script %}


<!-- popup -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.body.addEventListener("click", function (event) {
            // Otevření popupu
            if (event.target.classList.contains("btn add-book")) {
                const container = event.target.closest(".flex.flex-wrap.justify-between");
                if (container) {
                    container.querySelector(".overlay").classList.remove("hidden");
                    container.querySelector(".popup").classList.remove("hidden");
                }
            }

            // Zavření popupu kliknutím na overlay
            if (event.target.classList.contains("overlay")) {
                event.target.classList.add("hidden");
                event.target.nextElementSibling.classList.add("hidden"); // Zavře odpovídající popup
            }

            // Zavření popupu kliknutím na křížek
            if (event.target.closest("#closePopup")) {
                const popup = event.target.closest(".popup");
                const overlay = popup.previousElementSibling; // Overlay je přímo před popupem

                popup.classList.add("hidden");
                overlay.classList.add("hidden");
            }
        });
    });
</script>

<script>
    function showCommentModal(comment) {
        var modal = document.getElementById('commentModal');
        var commentText = document.getElementById('commentText');
        commentText.textContent = comment;
        modal.style.display = 'block';
    }

    var modal = document.getElementById('commentModal');
    var closeButton = document.getElementsByClassName("close-button")[0];

    closeButton.onclick = function() {
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>

{% endblock %}
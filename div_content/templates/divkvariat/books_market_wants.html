{% extends "divkvariat/base.html" %}
{% load humanize %}

{% block title %}Popt√°vky knih | DIVkvari√°t{% endblock %}

{% block content %}

<div class="listings-page">

    <h1 class="section-title">üìò Popt√°vky knih</h1>

    <p class="listings-intro">
        U≈æivatel√© zde popt√°vaj√≠ knihy, kter√© sh√°nƒõj√≠.
        Pokud nƒõkterou m√°te, vytvo≈ôte nab√≠dku.
    </p>

    <!-- KATEGORIE -->
    {% if categories %}
        <div class="listings-filters">

            <h2 class="section-subtitle">Kategorie</h2>

            <div class="filter-list">
                {% for g in categories %}
                    <a href="?zanr={{ g.url }}"
                    class="filter-pill
                    {% if selected_genre == g.url %}active{% endif %}
                    {% if forloop.counter > 2 %}hidden-mobile{% endif %}">
                        {{ g.genrenamecz }}
                    </a>
                {% endfor %}
            </div>

            <a href="#"
            onclick="showHidden(this)"
            class="filter-more">
                Zobrazit v≈°echny
            </a>
        </div>
    {% endif %}

    <!-- TOP KUPUJ√çC√ç -->
    {% if top_buyers %}
        <div class="listings-filters">

            <h2 class="section-subtitle">Top kupuj√≠c√≠</h2>

            <div class="filter-list">
                {% for buyer in top_buyers %}
                    <a href="/uzivatel/{{ buyer.id }}/koupim-knihy/"
                    class="filter-pill {% if forloop.counter > 2 %}hidden-mobile{% endif %}">
                        üõí {{ buyer.username }}
                        <span class="filter-meta">({{ buyer.total_buys }})</span>
                    </a>
                {% endfor %}
            </div>

            <a href="#"
            onclick="showHidden(this)"
            class="filter-more">
                Zobrazit v≈°echny
            </a>
        </div>
    {% endif %}

    <!-- LIST POPT√ÅVEK -->
    {% if listings %}
        <div class="listing-grid">

            {% for listing in listings %}
            <div class="listing-card">

                <a href="{% url 'listing_detail_buy' listing.book.url listing.booklistingid %}"
                class="listing-image">
                    {% if listing.book.img == "noimg.png" %}
                        <img src="/static/img/book/book.png" alt="">
                    {% elif listing.book.img == "GoogleID" %}
                        <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1" alt="">
                    {% else %}
                        <img src="https://media.div.cz/knihy/{{ listing.book.img }}" alt="">
                    {% endif %}
                </a>

                <h3 class="listing-title">
                    {{ listing.book.titlecz|default:listing.book.title }}
                </h3>

                <p class="listing-author">
                    {{ listing.book.author }}
                </p>

                <div class="listing-price want">
                    Sh√°n√≠m za {{ listing.price|floatformat:0 }} Kƒç
                </div>

                <a href="{% url 'listing_detail_buy' listing.book.url listing.booklistingid %}"
                class="listing-button">
                    Zobrazit popt√°vku
                </a>

                <div class="listing-meta">
                    Popt√°v√°:
                    <a href="/uzivatel/{{ listing.user.id }}/koupim-knihy/">
                        {{ listing.user.username }}
                    </a><br>
                    {{ listing.createdat|date:"j. n. Y" }}
                </div>

            </div>
            {% endfor %}

        </div>

        <!-- PAGINACE -->
        <div class="pagination">

            {% if listings.has_previous %}
                <a href="?page=1{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}">¬´ Prvn√≠</a>
                <a href="?page={{ listings.previous_page_number }}{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}">‚Äπ</a>
            {% endif %}

            <span class="pagination-current">
                Str√°nka {{ listings.number }} / {{ listings.paginator.num_pages }}
            </span>

            {% if listings.has_next %}
                <a href="?page={{ listings.next_page_number }}{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}">‚Ä∫</a>
                <a href="?page={{ listings.paginator.num_pages }}{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}">Posledn√≠ ¬ª</a>
            {% endif %}

        </div>

        {% else %}
        <p class="listings-empty">
            Moment√°lnƒõ zde nejsou ≈æ√°dn√© popt√°vky.
        </p>
    {% endif %}

</div>

<script>
    function showHidden(el) {
        el.previousElementSibling
        .querySelectorAll('.hidden-mobile')
        .forEach(x => x.classList.remove('hidden-mobile'));
        el.remove();
    }
</script>

{% endblock %}

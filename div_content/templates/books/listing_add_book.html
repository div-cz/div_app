{% extends "books/base.html" %}
{% load humanize %}
{% load custom_filters %}

{% block title %}Upravit nab√≠dku {{ book.title }} | DIV.cz{% endblock %}

{% block content %}

<style>
/* === UNIVERZ√ÅLN√ç FORM CONTROL === */
input[type="text"],
input[type="number"],
input[type="email"],
input[type="tel"],
select,
textarea {
    height: 48px;
    padding: 10px 14px;
    font-size: 16px;
    line-height: 1.4;
    border-radius: 12px;
    border: 1px solid #d1d5db;
    background-color: #fff;
    box-sizing: border-box;
}

.dark input[type="text"],
.dark input[type="number"],
.dark input[type="email"],
.dark input[type="tel"],
.dark select,
.dark textarea {
    background-color: #1A161F;
    border-color: #374151;
    color: #fff;
}

/* textarea v√Ωjimka */
textarea {
    height: auto;
    min-height: 120px;
}

/* === SELECT ‚Äì srovnat text vertik√°lnƒõ === */
select {
    padding-right: 40px;
    line-height: 1.4;
}

/* === Disabled select === */
select.disabled-select {
    background-color: #f3f4f6;
    color: #6b7280;
    cursor: not-allowed;
}

.dark select.disabled-select {
    background-color: #374151;
    color: #9ca3af;
}

/* === NUMBER INPUT ‚Äì spinner fix === */
input[type="number"] {
    appearance: textfield;
    -moz-appearance: textfield;
}

input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
    height: 100%;
}

/* === CHECKBOXY ‚Äì vƒõt≈°√≠ a konzistentnƒõj≈°√≠ === */
input[type="checkbox"] {
    width: 24px;
    height: 24px;
    accent-color: #22c55e;
    cursor: pointer;
    flex-shrink: 0;
}

label {
    cursor: pointer;
}

/* Bootstrap grid override pro lep≈°√≠ mezery */
.form-section {
    margin-bottom: 32px;
}

.form-section h4 {
    font-size: 18px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 16px;
}

.form-group {
    margin-bottom: 16px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
}
</style>

<div class="container mx-auto px-4 py-8" style="margin-top:20px">
    
    <h1 class="mt-8">
        <a href="/antikvariat/">DIVkvari√°t</a> /
        <a href="{% url 'listing_detail_sell' book_url=book.url listing_id=listing.booklistingid %}">
            Zpƒõt na nab√≠dku
        </a>
    </h1>
    <hr>

    {% if messages %}
    <div class="mt-3">
        {% for message in messages %}
            <div class="my-4 p-3 rounded bg-success-subtle alert-{{ message.tags }}">
                {{ message|safe }}
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="card mb-6">
        <div class="card-body">
            <h3 class="text-xl mb-4">Upravit nab√≠dku</h3>
            
            <div class="d-flex align-items-start mb-4">
                {% if book.img == "noimg.png" %}
                <img src="/static/img/book/book.png" alt="{{ book.titlecz|default:book.title }}" class="me-3" style="max-width:200px">
                {% elif book.img == "GoogleID" %}
                <img src="https://books.google.com/books/content?id={{ book.googleid }}&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api" alt="{{ book.titlecz|default:book.title }}" class="me-3" style="max-width:200px">
                {% else %}
                <img src="https://media.div.cz/knihy/{{ book.img }}" alt="{{ book.titlecz|default:book.title }}" class="me-3" style="max-width:200px">
                {% endif %}
                
                <div>
                    <h4 class="fw-bold">{{ book.titlecz|default:book.title }}</h4>
                    <p class="text-muted">{{ book.author }}</p>
                </div>
            </div>

            {% if listing.images.all %}
            <div class="mb-4 d-flex flex-wrap gap-2">
                {% for img in listing.images.all %}
                    <img src="{{ img.image.url }}" class="rounded" style="max-width:130px;">
                {% endfor %}
            </div>
            {% endif %}
            
            <form method="post">
                {% csrf_token %}
                
                <!-- SEKCE: Z√°kladn√≠ informace -->
                <div class="form-section">
                    <h4>Z√°kladn√≠ informace</h4>
                    
                    <!-- Typ a Cena -->
                    <div class="row">
                        <div class="col-md-6 form-group">
                            <label>Typ *</label>
                            <select disabled class="disabled-select">
                                <option>Prod√°m</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 form-group">
                            <label>Cena *</label>
                            <input type="number"
                                   name="new_price"
                                   min="0"
                                   required
                                   value="{{ listing.price|floatformat:0 }}">
                        </div>
                    </div>
                    
                    <!-- Popis -->
                    <div class="form-group">
                        <label>Popis *</label>
                        <textarea name="new_description" rows="5">{{ listing.description }}</textarea>
                    </div>
                </div>
                
                <hr>
                
                <!-- SEKCE: Stav a edice -->
                <div class="form-section">
                    <h4>Stav a edice</h4>
                    
                    <!-- Stav knihy a Rok vyd√°n√≠ -->
                    <div class="row">
                        <div class="col-md-6 form-group">
                            <label>Stav knihy</label>
                            <select name="condition">
                                <option value="">-- Vyberte --</option>
                                <option value="nova" {% if listing.condition == "nova" %}selected{% endif %}>Nov√°</option>
                                <option value="jako-nova" {% if listing.condition == "jako-nova" %}selected{% endif %}>Pou≈æit√°, jako nov√°</option>
                                <option value="dobry" {% if listing.condition == "dobry" %}selected{% endif %}>Pou≈æit√°, dobr√Ω stav</option>
                                <option value="zachovaly" {% if listing.condition == "zachovaly" %}selected{% endif %}>Pou≈æit√°, zachoval√Ω stav</option>
                                <option value="spatny" {% if listing.condition == "spatny" %}selected{% endif %}>≈†patn√Ω stav</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 form-group">
                            <label>Rok vyd√°n√≠</label>
                            <input type="number"
                                   name="editionyear"
                                   value="{{ listing.editionyear|default:'' }}"
                                   placeholder="(volitelnƒõ)">
                        </div>
                    </div>
                    
                    <!-- Prvn√≠ vyd√°n√≠ -->
                    <div class="form-group d-flex align-items-center" style="gap: 12px;">
                        <input type="checkbox"
                               name="firstedition"
                               id="id_firstedition"
                               {% if listing.firstedition %}checked{% endif %}>
                        <label for="id_firstedition" class="mb-0">Prvn√≠ vyd√°n√≠</label>
                    </div>
                    
                    <!-- Ediƒçn√≠ pozn√°mka -->
                    <div class="form-group">
                        <label>Ediƒçn√≠ pozn√°mka</label>
                        <input type="text"
                               name="edition_note"
                               value="{{ listing.edition_note|default:'' }}"
                               placeholder="(volitelnƒõ)">
                    </div>
                </div>
                
                <hr>
                
                <!-- SEKCE: Kontakt a doruƒçen√≠ -->
                <div class="form-section">
                    <h4>Kontakt a doruƒçen√≠</h4>
                    
                    <!-- Osobn√≠ p≈ôevzet√≠ a M√≠sto -->
                    <div class="row align-items-end">
                        <div class="col-md-6 form-group">
                            <div class="d-flex align-items-center" style="gap: 12px;">
                                <input type="checkbox"
                                       name="personal_pickup"
                                       id="id_personal_pickup"
                                       {% if "OSOBNI" in listing.shippingoptions %}checked{% endif %}>
                                <label for="id_personal_pickup" class="mb-0">Osobn√≠ p≈ôevzet√≠</label>
                            </div>
                        </div>
                        
                        <div class="col-md-6 form-group">
                            <label>M√≠sto</label>
                            <input type="text"
                                   name="new_location"
                                   value="{{ listing.location|default:'' }}"
                                   placeholder="nap≈ô. Praha, Brno...">
                        </div>
                    </div>
                    
                    <!-- Po≈°tovn√© -->
                    <div>
                        <label class="fw-bold mb-3">Mo≈ænosti po≈°tovn√©ho</label>
                        
                        <div class="row">
                            <!-- Z√°silkovna -->
                            <div class="col-md-4 form-group">
                                <div class="d-flex align-items-center mb-2" style="gap: 12px;">
                                    <input type="checkbox"
                                           name="shipping_zasilkovna"
                                           id="id_shipping_zasilkovna"
                                           {% if "ZASILKOVNA" in listing.shippingoptions %}checked{% endif %}>
                                    <label for="id_shipping_zasilkovna" class="mb-0 fw-bold">Z√°silkovna</label>
                                </div>
                                <input type="number"
                                       name="shipping_zasilkovna_price"
                                       min="0"
                                       value="{{ current_shipping.ZASILKOVNA|default:'89' }}">
                            </div>
                            
                            <!-- Bal√≠kovna -->
                            <div class="col-md-4 form-group">
                                <div class="d-flex align-items-center mb-2" style="gap: 12px;">
                                    <input type="checkbox"
                                           name="shipping_balikovna"
                                           id="id_shipping_balikovna"
                                           {% if "BALIKOVNA" in listing.shippingoptions %}checked{% endif %}>
                                    <label for="id_shipping_balikovna" class="mb-0 fw-bold">Bal√≠kovna</label>
                                </div>
                                <input type="number"
                                       name="shipping_balikovna_price"
                                       min="0"
                                       value="{{ current_shipping.BALIKOVNA|default:'99' }}">
                            </div>
                            
                            <!-- ƒåesk√° po≈°ta -->
                            <div class="col-md-4 form-group">
                                <div class="d-flex align-items-center mb-2" style="gap: 12px;">
                                    <input type="checkbox"
                                           name="shipping_posta"
                                           id="id_shipping_posta"
                                           {% if "POSTA" in listing.shippingoptions %}checked{% endif %}>
                                    <label for="id_shipping_posta" class="mb-0 fw-bold">ƒåesk√° po≈°ta</label>
                                </div>
                                <input type="number"
                                       name="shipping_posta_price"
                                       min="0"
                                       value="{{ current_shipping.POSTA|default:'109' }}">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tlaƒç√≠tka -->
                <div class="d-flex" style="gap: 16px;">
                    <button type="submit" class="add-book">
                        üíæ Ulo≈æit zmƒõny
                    </button>
                    <a href="{% url 'listing_detail_sell' book_url=book.url listing_id=listing.booklistingid %}"
                       class="btn btn-outline-secondary">
                        Zru≈°it
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}
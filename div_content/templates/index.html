{% load humanize %}
<!DOCTYPE html>
<html lang="cs">
    
    <head>
        {% include "inc/head_new.html" %}

        <title>DIV.cz | Databáze filmů, knih a her DIV</title>

        <link href="/web/css/index.css" rel="stylesheet">
        <link href="/web/css/navbar_other.css" rel="stylesheet">
        <link href="/web/css/navbar.css" rel="stylesheet">
        <link href="/web/css/hodnoceni.css" rel="stylesheet">

        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick.css"/>
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick-theme.css"/>
        <script src="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick.min.js"></script>

        {% include "inc/google.html" %}

        <meta name="description" content="Objevujte a hodnoťte knihy, hry i filmy na DIV.cz. Připojte se k naší komunitě a získejte přístup k obsahu, recenzím a hodnocením.">
        
        <!-- Open Graph Meta Tags -->
        <meta property="og:title" content="DIV.cz | Databáze filmů, her a knih DIV">
        <meta property="og:description" content="Objevujte a hodnoťte knihy, hry i filmy na DIV.cz. Připojte se k naší komunitě a získejte přístup k obsahu, recenzím a hodnocením.">
        <meta property="og:image" content="https://div.cz/img/movie/filmovy-div.webp">
        <meta property="og:url" content="https://div.cz">
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="DIV.cz">
        
        <!-- Twitter Meta Tags -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="DIV.cz | Databáze filmů, her a knih DIV">
        <meta name="twitter:description" content="Objevujte a hodnoťte filmy, hry a knihy na DIV.cz. Připojte se k naší komunitě a získejte přístup k obsahu, recenzím a hodnocením.">
        <meta name="twitter:image" content="https://div.cz/img/movie/filmovy-div.webp">
        <meta name="twitter:site" content="@DIV_cz">
        <meta name="twitter:creator" content="@DIV_cz">

        <link rel="apple-touch-icon" href="/static/img/site/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="57x57" href="/static/img/site/apple/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/static/img/site/apple/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/static/img/site/apple/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/static/img/site/apple/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/static/img/site/apple/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="/static/img/site/apple/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/static/img/site/apple/apple-touch-icon-152x152.png">
        
        <meta name="msapplication-square70x70logo" content="/static/img/site/microsoft/div_70.png">
        <meta name="msapplication-square150x150logo" content="/static/img/site/microsoft/div_150.png">
        <meta name="msapplication-wide310x150logo" content="/static/img/site/microsoft/div_310x150.png">
        <meta name="msapplication-square310x310logo" content="/static/img/site/microsoft/div_310.png">
        <meta name="msapplication-TileImage" content="/static/img/site/microsoft/div_152.png">
        <meta name="msapplication-TileColor" content="#FFFFFF"> 
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="theme-color" content="#ffffff">

        <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">

        <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

        <style>
            .button-next,
            .button-prev {
                z-index: 10;
            }

            .button-next:after, .button-prev:after {
                font-family: swiper-icons;
                font-size: 20px;
                text-transform: none !important;
                letter-spacing: 0;
                font-variant: initial;
                line-height: 1;
                color: #607d8b;
            }

            .button-prev {
                height: 100%;
                top: 0;
                box-shadow: 10px 0px 20px 0px #f8f8f8;
            }

            .button-prev:is(.dark *) {
                box-shadow: 10px 0px 20px 0px #252229;
            }

            .button-next {
                height: 100%;
                top: 0;
                box-shadow: -10px 0px 20px 0px #f8f8f8;
            }

            .button-next:is(.dark *) {
                box-shadow: -10px 0px 20px 0px #252229;
            }

            .button-next, .button-prev {
                align-items: center;
                color: #007aff;
                cursor: pointer;
                display: flex;
                height: 44px;
                justify-content: center;
                position: absolute;
                width: 26px;
                z-index: 10;
                height: 100%;
            }

            .button-next, .button-prev {
                svg {
                    height: 20px;
                    object-fit: contain;
                    transform-origin: center;
                    width: 100%;
                    fill: currentColor;
                    pointer-events: none;
                }
            }
            
            /* Vylepšení zobrazení pagination */
            .swiper-pagination {
                position: absolute;
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
            }

            .swiper-button-next {
                left: auto;
                right: 4px;
            }

            .swiper-pagination-bullet {
                height: 13px;
                width: 13px;
                opacity: 0.5;
                background: #607d8b;
            }

            .swiper-pagination-bullet-active {
                opacity: 1;
            }

            .swiper-horizontal {
                &.swiper-rtl .button-prev, &.swiper-rtl~.swiper-button-prev, &~.swiper-button-next, .swiper-button-next {
                    left: auto;
                    right: var(--swiper-navigation-sides-offset, 4px);
                }
            }

            .swiper-horizontal {
                .swiper-button-next, .swiper-button-prev, ~.swiper-button-next, ~.swiper-button-prev {
                    margin-left: 0;
                    margin-top: calc(0px - var(--swiper-navigation-size) / 2);
                    top: 0;
                }
            }

            .button-next svg path,
            .button-prev svg path {
                stroke: currentColor;
                stroke-width: 2;
            }

            .card .card-body .card .card-body:is(.dark *) {
                background: #0d0c0f;
            }

            .form-group {
                margin-bottom: 0;
            }

            .form-group label {
                width: 100%;
            }
        </style>

    </head>

    <body>

        {% include "inc/navbar_index_new.html" %}

        <main>
            <section>
                
                {% include "inc/sidebar_new.html" %}
                
                <div class="container">
                    <!-- LEVÁ STRANA-->
                    <div class="left-side">

                        <!-- CAROUSEL -->
                        <div class="carousel-container-index">
                            <div id="films-carousel" class="carousel-index carousel-fade">
                                <div class="carousel-track-index" data-offset="0">
                                    <div class="carousel-item-index">
                                        <a href="https://div.cz/knihy/">
                                            <img src="https://div.cz/img/book/knizni-div.webp" alt="Knihy na DIV.cz">
                                            <h5>Svět knih, her a filmů</h5>
                                        </a>
                                    </div>        
                                    <div class="carousel-item-index">
                                        <a href="">
                                            <img src="https://div.cz/img/game/herni-div.webp" alt="Hry na DIV.cz">
                                            <h5>Svět her</h5>
                                        </a>
                                    </div>
                                    <div class="carousel-item-index">
                                        <a href="https://div.cz/filmy/">
                                            <img src="https://div.cz/img/movie/filmovy-div.webp" alt="">
                                                <h5>Filmový svět</h5>
                                        </a>
                                    </div>
                                    <div class="carousel-item-index">
                                        <a href="">
                                            <img src="https://cdn1.epicgames.com/salesEvent/salesEvent/EGS_RiseoftheTombRaider20YearCelebration_CrystalDynamics_S1_2560x1440-3bd5b3c4c11d46cc2dcb06bdf2f77627" alt="">
                                            <h5></h5>
                                        </a>
                                    </div>
                                    <div class="carousel-item-index">
                                        <a href="">
                                            <img src="https://prh.imgix.net/articles/top10-fiction-1600x800.jpg" alt="">
                                            <h5></h5>
                                        </a>
                                    </div>
                                    <div class="carousel-item-index">
                                        <a href="">
                                            <img src="https://i.ibb.co/R66Zgzz/koc48dky-c3batoc48dc3ad-rec.webp" alt="">
                                            <h5></h5>
                                        </a>
                                    </div>
                                    <div class="carousel-item-index">
                                        <a href="">
                                            <img src="https://ctfs.ceskatelevize.cz/porady-s3/64884c0340b628ecc30d009b/card/bod-obnovy-1692031353725.jpg" alt="">
                                            <h5></h5>
                                        </a>
                                    </div>
                                    <div class="carousel-item-index">
                                        <a href="">
                                            <img src="https://basecamplive.com/wp-content/uploads/2023/02/books.jpeg" alt="">
                                            <h5></h5>
                                        </a>
                                    </div>
                                    <div class="carousel-item-index">
                                        <a href="/film/tancuj-matyldo">
                                            <img src="https://www.themoviedb.org/t/p/w1066_and_h600_bestv2//xWuWxb6N3pwAMw1EqI7So8gHtcL.jpg" alt="">
                                            <h5>Tancuj Matydlo</h5>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {% if messages %}
                            <div style="margin-top: .75rem;">
                                {% for message in messages %}
                                    <div class="alert alert-{{ message.tags }}" role="alert">
                                        {{ message|safe }}
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}

                        <div class="info-card">
                            <div class="card">
                                <div class="card-body">
                                    <p style="text-align: center;">
                                        DIV.cz je stránka, která propojuje <a href="/knihy/" class="books">knihy</a>, <a href="/filmy/" class="movies">filmy</a> a <a href="/hry/" class="games">hry</a> skrze postavy, lokality a
                                        další prvky.
                                    </p>
                                </div>
                            </div>

                            <div class="account-section">
                                <!-- VÝPLATA -->
                                {% if pending_payouts_list and user.is_superuser and user.username == "Martin" %}
                                    <div class="account-box admin-payouts">

                                        <h3 class="account-title">
                                            Výplaty pro prodejce
                                            <span class="account-subtitle">(přehled pro superuser)</span>
                                        </h3>

                                        <div class="payout-list">
                                            {% for user_request in pending_payouts_list %}
                                                <div class="payout-item">

                                                    <div class="payout-info">
                                                        <p class="payout-user">
                                                            Prodávající:
                                                            <strong>{{ user_request.user_name|default:user_request.username }}</strong>
                                                        </p>

                                                        <p class="payout-account">
                                                            Číslo účtu: {{ bank_account }}
                                                        </p>

                                                        <img
                                                            src="data:image/png;base64,{{ request_qr_code }}"
                                                            alt="QR kód pro platbu"
                                                            class="payout-qr"
                                                        >

                                                        <p class="payout-amount">
                                                            Celková částka:
                                                            <strong>{{ user_request.total_amount }} Kč</strong>
                                                        </p>
                                                    </div>

                                                    <form method="post" class="payout-action">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="user_id" value="{{ user_request.user }}">
                                                        <button type="submit"
                                                                name="confirm_user_payment"
                                                                class="btn btn-primary">
                                                            Potvrdit vyplacení
                                                        </button>
                                                    </form>

                                                </div>
                                            {% endfor %}
                                        </div>

                                    </div>
                                {% endif %}

                                <!-- objednávky potvrzení -->
                                {% if user.is_authenticated %}
                                    <!-- Poslední nákupy eKnih -->
                                    {% if user.is_superuser and last_ebook_purchases %}
                                        <div class="account-box">
                                            <h3 class="account-title">Poslední nákupy eKnih</h3>
                                            <ul class="account-list">
                                                {% for purchase in last_ebook_purchases %}
                                                    <li class="account-list-item">
                                                        <strong>{{ purchase.user.username }}</strong>
                                                        koupil
                                                        <strong>{{ purchase.book.titlecz }}</strong>
                                                        <span class="account-meta">{{ purchase.status }}</span>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    {% endif %}

                                    <!-- Moje nákupy v DIVkvariátu -->
                                    {% if pending_book_purchases %}
                                        <div class="account-box">
                                            <h3 class="account-title">Moje nákupy v DIVkvariátu</h3>
                                            <div class="account-pending">
                                                {% for listing in pending_book_purchases %}
                                                    <div class="pending-item">
                                                        <div class="pending-info">
                                                            <strong>{{ listing.book.titlecz }}</strong>
                                                            <span>Čeká na platbu</span>
                                                        </div>
                                                        <img src="{% url 'show_qr_payment' listing.id %}" alt="QR kód">
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}

                                    <!-- Moje prodeje v DIVkvariátu -->
                                    {% if my_active_actions %}
                                        <div class="account-box">
                                            <h3 class="account-title">Moje obchody, které čekají na akci</h3>
                                            <ul class="trade-list">
                                                {% for listing in my_active_actions %}
                                                    <li class="trade-item">
                                                        <div class="trade-card">
                                                            <div class="trade-cover">
                                                                {% if listing.book.img == "noimg.png" %}
                                                                    <img src="/static/img/book/book.png">
                                                                {% elif listing.book.img == "GoogleID" %}
                                                                    <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1">
                                                                {% else %}
                                                                    <img src="https://media.div.cz/knihy/{{ listing.book.img }}">
                                                                {% endif %}
                                                            </div>

                                                            <div class="trade-info">
                                                                <a href="{% url 'listing_detail_sell' book_url=listing.book.url listing_id=listing.booklistingid %}">
                                                                    {{ listing.book.titlecz|default:listing.book.title }}
                                                                </a>

                                                                <div class="trade-meta">
                                                                    Role: {% if listing.user == request.user %}Prodejce{% else %}Kupující{% endif %}<br>
                                                                    Datum: {{ listing.createdat|date:"j. n. Y" }}<br>
                                                                    Cena: {{ listing.price|default:0 }} Kč
                                                                    {% if listing.shipping %}+ {{ listing.shipping }} Kč{% endif %}
                                                                </div>

                                                                <div class="trade-action">
                        {% if listing.status == 'RESERVED' and listing.buyer == request.user %}
                            <a href="{% url 'listing_detail_sell' book_url=listing.book.url listing_id=listing.booklistingid %}"
                               class="text-[#A52B21] font-medium">
                               Čeká se na zaplacení
                            </a>
                        {% elif listing.status == 'PAID' and listing.user == request.user %}
                            <a href="{% url 'listing_detail_sell' book_url=listing.book.url listing_id=listing.booklistingid %}"
                               class="text-[#61872B] font-medium">
                               Kupující zaplatil – odešlete knihu
                            </a>
                        {% elif listing.status in 'PAID' and listing.buyer == request.user %}
                            <a href="{% url 'listing_detail_sell' book_url=listing.book.url listing_id=listing.booklistingid %}"
                               class="text-[#00A0E3] font-medium">
                               Čekáme na doručení knihy
                            </a>
                        {% elif listing.status in 'SHIPPED' and listing.buyer == request.user %}
                            <a href="{% url 'listing_detail_sell' book_url=listing.book.url listing_id=listing.booklistingid %}"
                               class="text-[#00A0E3] font-medium">
                               Čekáme na doručení knihy
                            </a>
                        {% elif listing.status in 'SHIPPED' and listing.user == request.user %}
                            <a href="{% url 'listing_detail_sell' book_url=listing.book.url listing_id=listing.booklistingid %}"
                               class="text-[#00A0E3] font-medium">
                               Čekáme na potvrzení převzetí
                            </a>
                        {% elif listing.status == 'COMPLETED' and listing.user == request.user and not listing.buyerrating %}
                            <a href="{% url 'listing_detail_sell' book_url=listing.book.url listing_id=listing.booklistingid %}"
                               class="text-[#FF6D00] font-medium">
                               Ohodnoťte kupujícího
                            </a>
                        {% elif listing.status == 'COMPLETED' and listing.buyer == request.user and not listing.sellerrating %}
                            <a href="{% url 'listing_detail_sell' book_url=listing.book.url listing_id=listing.booklistingid %}"
                               class="text-[#FF6D00] font-medium">
                               Ohodnoťte prodejce
                            </a>
                        {% endif %}

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    {% endif %}

                                    <!-- Moje eKnihy -->
                                    {% if user_ebook_purchases %}
                                        <div class="account-box">
                                            <h3 class="account-title">Moje eKnihy</h3>

                                            <ul class="account-list">
                                                {% for purchase in user_ebook_purchases %}
                                                    <li class="account-list-item">
                                                        <a href="/kniha/{{ purchase.book.url }}">
                                                            {{ purchase.book.titlecz|default:purchase.book.title }}
                                                        </a>
                                                        <small>({{ purchase.format }})</small>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    {% endif %}
                                {% endif %}

                                <!--Moje potávky v div kvariátu-->
                                {% if user_wanted_purchases  %}
                                    <ul class="my-market-list">
                                        {% for listing in user_wanted_purchases %}
                                            <li class="my-market-item">
                                                <div class="my-market-card">
                                                    <div class="my-market-cover">
                                                        {% if listing.book.img == "noimg.png" %}
                                                            <img src="/static/img/book/book.png" alt="Kniha {{ listing.book.titlecz }}">
                                                            {% elif listing.book.img == "GoogleID" %}
                                                            <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api" alt="{{ listing.book.titlecz }}">
                                                            {% else %}
                                                            <img src="https://media.div.cz/knihy/{{ listing.book.img }}" alt="{{ listing.book.titlecz }}">
                                                        {% endif %}
                                                    </div>

                                                    <!-- info -->
                                                    <div class="my-market-info">
                                                        <a class="my-market-title"
                                                        href="{% url 'listing_detail_sell' book_url=listing.book.url listing_id=listing.booklistingid %}">
                                                            {{ listing.book.titlecz }}
                                                        </a>

                                                        <span class="my-market-status
                                                            {% if listing.status == 'ACTIVE' %} status-active
                                                            {% elif listing.status == 'RESERVED' %} status-reserved
                                                            {% elif listing.status == 'COMPLETED' %} status-completed
                                                            {% endif %}">
                                                            {{ listing.get_status_display }}
                                                        </span>

                                                        <small class="my-market-date">
                                                            Vytvořeno: {{ listing.createdat }}
                                                        </small>
                                                    </div>

                                                    <!-- cena -->
                                                    <div class="my-market-price books">
                                                        {{ listing.price }} Kč
                                                    </div>

                                                </div>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>

                            <!-- CAROUSEL FILMY -->
                            <div class="card">
                                <div class="card-body">
                                    <h3 class="card-title after-h3">Ze světa filmů</h3>
                                    <div class="swiper">
                                        <div class="card-wrapper">
                                            <div class="card-list swiper-wrapper">
                                                {% for item in movies_carousel %}
                                                    <div class="card-item swiper-slide">
                                                        <!-- hodnocení -->
                                                        <div class="carousel-ratting">
                                                            <div class="rating" data-rating="{{ item.real_rating }}">
                                                                <div class="rating-inner">
                                                                    {{ item.real_rating }}%
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <a href="/film/{{ item.url }}" class="card-link">
                                                            <img src="https://image.tmdb.org/t/p/w300_and_h450_bestv2{{ item.img }}" class="card-image" alt="{{ item.title }}">
                                                        </a>
                                                        <p>
                                                            <small>{{ item.title }}</small>
                                                        </p>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                            
                                            <div class="swiper-pagination"></div>
                                            <div class="swiper-slide-button swiper-button-prev button-prev"></div>
                                            <div class="swiper-slide-button swiper-button-next button-next"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- CAROUSEL SERIÁLY -->
                            <div class="card">
                                <div class="card-body">
                                    <h3 class="card-title after-h3">Ze světa seriálů</h3>
                                    <div class="swiper">
                                        <div class="card-wrapper">
                                            <div class="card-list swiper-wrapper">
                                                {% for item in series_carousel %}
                                                    <div class="card-item swiper-slide">
                                                        <!-- hodnocení -->
                                                        <div class="carousel-ratting">
                                                            <div class="rating" data-rating="{{ item.real_rating }}">
                                                                <div class="rating-inner">
                                                                    {{ item.real_rating }}%
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <a href="/serial/{{ item.url }}" class="card-link">
                                                            <img src="https://image.tmdb.org/t/p/w300_and_h450_bestv2/{{ item.img }}" class="card-image" alt="{{ item.title }}">
                                                        </a>
                                                        <p>
                                                            <small>{{ item.title }}</small>
                                                        </p>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                            
                                            <div class="swiper-pagination"></div>
                                            <div class="swiper-slide-button swiper-button-prev button-prev"></div>
                                            <div class="swiper-slide-button swiper-button-next button-next"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- CAROUSEL KNIHY -->
                            <div class="card">
                                <div class="card-body">
                                    <h3 class="card-title after-h3">Ze světa knih</h3>
                                    <div class="swiper">
                                        <div class="card-wrapper">
                                            <div class="card-list swiper-wrapper">
                                                {% for item in books_carousel %}
                                                    <div class="card-item swiper-slide">
                                                        <!-- hodnocení -->
                                                        <div class="carousel-ratting">
                                                            <div class="rating" data-rating="{{ item.real_rating }}">
                                                                <div class="rating-inner">
                                                                    {{ item.real_rating }}%
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <a href="/kniha/{{ item.url }}" class="card-link">
                                                            <img src="https://media.div.cz/knihy/{{ item.img }}" class="card-image" alt="{{ item.title }}">
                                                        </a>

                                                        {% if item.author %}
                                                            <p>
                                                                <small>{{ item.author }}</small>
                                                            </p>
                                                        {% endif %}

                                                        <p>
                                                            <small>{{ item.title }}</small>
                                                        </p>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                            
                                            <div class="swiper-pagination"></div>
                                            <div class="swiper-slide-button swiper-button-prev button-prev"></div>
                                            <div class="swiper-slide-button swiper-button-next button-next"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- CAROUSEL HRY -->
                            <div class="card">
                                <div class="card-body">
                                    <h3 class="card-title after-h3">Ze světa her</h3>
                                    <div class="swiper">
                                        <div class="card-wrapper">
                                            <div class="card-list swiper-wrapper">
                                                {% for item in games_carousel %}
                                                    <div class="card-item swiper-slide">
                                                        <!-- hodnocení -->
                                                        <div class="carousel-ratting">
                                                            <div class="rating" data-rating="{{ item.real_rating }}">
                                                                <div class="rating-inner">
                                                                    {{ item.real_rating }}%
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <a href="/hra/{{ item.url }}" class="card-link">
                                                            <img src="/static/hra{{ item.img }}" class="card-image" alt="{{ item.title }}">
                                                        </a>
                                                        <p>
                                                            <small>{{ item.title }}</small>
                                                        </p>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                            
                                            <div class="swiper-pagination"></div>
                                            <div class="swiper-slide-button swiper-button-prev button-prev"></div>
                                            <div class="swiper-slide-button swiper-button-next button-next"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- novinky -->
                            <div class="card">
                                <div class="card-body">
                                    <h3 class="card-title after-h3">&#128276; Novinky</h3>

                                    <!-- H O V I N K A    add by M a r t i n  -->
                                    {% if user.is_superuser or user.is_staff %}
                                        <div class="add-content">
                                            <details>
                                                <!-- Formulář pro přidání novinky -->
                                                <summary style="font-size: 1.17rem;">Přidej novinku</summary>
                                                <form method="POST" class="form">
                                                    {% csrf_token %}
                                                    <div class="form-group">
                                                        <label for="id_title">Titulek</label>
                                                        {{ articlenews_form.title }}
                                                    </div>
                                                    
                                                    <div class="form-group">
                                                        <label for="id_news">Novinka</label>
                                                        {{ articlenews_form.news }}
                                                    </div>
                                                    
                                                    <div class="form-group">
                                                        <label for="id_img">Img (linkovat obrázky z div.cz)</label>
                                                        {{ articlenews_form.img }}
                                                    </div>
                                                    
                                                    <div class="form-group">
                                                        <label for="id_alt">Alt</label>
                                                        {{ articlenews_form.alt }}
                                                    </div>
                                                    
                                                    <div class="form-group">
                                                        <label for="id_source">Zdroj (Variety.com atp.)</label>
                                                        {{ articlenews_form.source }}
                                                    </div>
                                                    
                                                    <div class="form-group" style="margin-bottom: 1rem;">
                                                        <label for="id_typ">Typ (Movie, Serie, Book, Game)</label>
                                                        {{ articlenews_form.typ }}
                                                    </div>

                                                    <button type="submit" name="articlenews_submit" class="btn btn-primary">Přidat novinku</button>
                                                </form>
                                            </details>
                                        </div>
                                    {% endif %}

                                    <!-- výpis novinek -->
                                    <div class="news-list">
                                        {% for news in articlenews %}
                                            <article class="news-item">
                                                <h4 class="news-title">{{ news.title|safe }}</h4>

                                                <div class="news-content biography-text">
                                                    {{ news.news|safe }}
                                                </div>

                                                <a class="news-toggle toggle-biography">Více…</a>

                                                <div class="news-meta">
                                                    {{ news.source }} • {{ news.created }}
                                                </div>
                                            </article>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                           
                            <!-- Nejnovější komentáře -->
                            <div class="card">
                                <div class="card-body">
                                    <h3 class="card-title after-h3">&#128221;&#65039; Nejnovější recenze</h3>

                                    {% for comment in latest_comments %}
                                        <div class="all-comments-tab">

                                            <!-- TAG / OBJEKT -->
                                            {% if comment.movieid %}
                                                <p class="comment-head">&#127902;&#65039;
                                                    <a href="/film/{{ comment.movieid.url }}" class="movies">
                                                        {{ comment.movieid.titlecz }}
                                                    </a>
                                                </p>

                                            {% elif comment.bookid %}
                                                <p class="comment-head">&#128214;
                                                    <a href="/kniha/{{ comment.bookid.url }}" class="books">
                                                        {{ comment.bookid.titlecz }}
                                                    </a>
                                                </p>

                                            {% elif comment.gameid %}
                                                <p class="comment-head">&#127918;
                                                    <a href="/hra/{{ comment.gameid.url }}" class="games">
                                                        {{ comment.gameid.titlecz }}
                                                    </a>
                                                </p>

                                            {% elif comment.tvshowkid %}
                                                <p class="comment-head">&#128250;
                                                    <a href="{% url 'serie_detail' tv_url=comment.tvshowkid.url %}"
                                                    class="series">
                                                        {{ comment.tvshowkid.titlecz|default:comment.tvshowkid.title }}
                                                    </a>
                                                </p>
                                            {% endif %}

                                            <!-- TEXT KOMENTÁŘE -->
                                            <p class="comment">
                                                {{ comment.comment|truncatewords:20 }}
                                            </p>

                                            <!-- UŽIVATEL -->
                                            <div class="user-comment">
                                                <small>
                                                    Uživatel:
                                                    <a href="/uzivatel/{{ comment.user.username }}">
                                                        {{ comment.user.username }}
                                                    </a>
                                                </small>
                                            </div>

                                        </div>
                                    {% endfor %}
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- PRAVÁ STRANA -->
                    <div class="right-side">

                        <!-- narozeniny -->
                        <div class="card">
                            <div class="card-body">
                                <h3 class="card-title after-h3">&#127874; Narozeniny slaví</h3>

                                {% load cache %}
                                {% cache 28800 creators_list_birth %}
                                    <div class="birthday-list">
                                        {% for creator in creators_list_8 %}
                                            <div class="birthday-item">
                                                <img src="{% if creator.img == 'noimg.png' %}http://media.div.cz/media/noperson.svg{% else %}https://www.themoviedb.org/t/p/w300/{{ creator.img }}{% endif %}" alt="{{ creator.firstname }} {{ creator.lastname }}" class="birthday-avatar">

                                                <div class="birthday-info">
                                                    <h4>
                                                        <a href="{% url 'creator_detail' creator.url %}">
                                                            {{ creator.firstname }} {{ creator.lastname }}
                                                        </a>
                                                    </h4>

                                                    <div class="birthday-meta">
                                                        <span class="birthday-date">
                                                            {{ creator.birthdate|date:"d.m.Y" }}
                                                        </span>
                                                        <span class="birthday-role">
                                                            {% if creator.knownfordepartment == "Acting" %}
                                                                Herec
                                                                {% elif creator.knownfordepartment == "Directing" %}
                                                                Režisér
                                                                {% elif creator.knownfordepartment == "Production" %}
                                                                Producent
                                                                {% elif creator.knownfordepartment == "Writing" %}
                                                                Scénárista
                                                                {% else %}
                                                                Těžko říct
                                                            {% endif %}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endcache %}

                                <!--<a href="https://div.cz/tvurci/dnes/" class="birthday-more">
                                    <small>Zobrazit další</small>
                                </a>-->
                            </div>
                        </div>

                        <!-- články -->
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title after-h3">
                                    <h3>&#128240;&#65039; Články</h3>
                                    <a href="{% url 'articles_index' %}"><small>Zobrazit vše</small></a>
                                </div>

                                {% for article in articles %}
                                    <div class="article">
                                        {% if article.img1600 %}
                                            <img src="{{ article.img1600 }}" alt="{{ article.title }}">
                                            {% elif article.img %}
                                            <img src="https://image.tmdb.org/t/p/w300_and_h450_bestv2{{ article.img }}" alt="{{ article.title }}">
                                        {% endif %}

                                        <div class="article-text">
                                            <a href="{{ article.url }}">{{ article.title }}</a>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- BURZA KNIH -->
                        <div class="card">
                            <div class="card-body">
                                <h3 class="card-title after-h3">&#128717; Burza knih</h3>

                                <!-- prodej -->
                                <div class="book-market">
                                    <div class="book-market-title">
                                        <h4>Prodej</h4>
                                        <a href="{% url 'books_market_offers' %}"><small>Zobrazit vše</small></a>
                                    </div>

                                    {% for listing in recent_sell_listings %}
                                        <div class="book-market-body">
                                            <a href="{% url 'listing_detail_sell' listing.book.url listing.booklistingid %}">
                                                {% if listing.book.img == "noimg.png" %}
                                                    <!-- Pokud je book.img "noimg.png", zobraz výchozí obrázek -->
                                                    <img src="/static/img/book/book.png" alt="Kniha {{ listing.book.titlecz }}" alt="odkaz na knihu">
                                                    {% elif listing.book.img == "GoogleID" %}
                                                    <!-- Pokud je book.img "GoogleID", zobraz náhled z Google Books -->
                                                    <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api" alt="{{ listing.book.titlecz }}" alt="odkaz na knihu">
                                                    {% else %}
                                                    <!-- Jinak zobraz vlastní nahraný obrázek -->
                                                    <img src="https://media.div.cz/knihy/{{ listing.book.img }}" alt="{{ listing.book.titlecz }}" alt="odkaz na knihu">
                                                {% endif %}
                                            </a>

                                            <div class="book-market-text">
                                                <p>
                                                   <a href="{% url 'listing_detail_sell' listing.book.url listing.booklistingid %}">
                                                        {{ listing.book.titlecz|default:listing.book.title }}
                                                    </a>
                                                </p>
                                                <p>{{ listing.book.author }}</p>
                                                <p class="book-market-price books">
                                                    {% if listing.price %}
                                                        {{ listing.price|floatformat:0 }} Kč
                                                        {% else %}
                                                        Daruji
                                                    {% endif %}
                                                </p>

                                                <p class="book-market-user">
                                                    <small>
                                                        Přidal: 
                                                        <a href="{% url 'user_sell_listings' listing.user.id %}" class="books">
                                                            {{ listing.user.username }}
                                                        </a>
                                                        <span> • </span>
                                                        {{ listing.createdat|date:"j.n.Y" }}
                                                    </small>
                                                </p>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>

                                <hr>

                                <!-- poptávka -->
                                <div class="book-market">
                                    <div class="book-market-title">
                                        <h4>Poptávka</h4>
                                        <a href="{% url 'books_market_wants' %}"><small>Zobrazit vše</small></a>
                                    </div>

                                    {% for listing in recent_buy_listings %}
                                        <div class="book-market-body">
                                            <a href="{% url 'listing_detail_buy' listing.book.url listing.booklistingid %}">
                                                {% if listing.book.img == "noimg.png" %}
                                                    <!-- Pokud je book.img "noimg.png", zobraz výchozí obrázek -->
                                                    <img src="/static/img/book/book.png" alt="Kniha {{ listing.book.titlecz }}" alt="odkaz na knihu">
                                                    {% elif listing.book.img == "GoogleID" %}
                                                    <!-- Pokud je book.img "GoogleID", zobraz náhled z Google Books -->
                                                    <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api" alt="{{ listing.book.titlecz }}" alt="odkaz na knihu">
                                                    {% else %}
                                                    <!-- Jinak zobraz vlastní nahraný obrázek -->
                                                    <img src="https://media.div.cz/knihy/{{ listing.book.img }}" alt="{{ listing.book.titlecz }}" alt="odkaz na knihu">
                                                {% endif %}
                                            </a>

                                            <div class="book-market-text">
                                                <p>
                                                    <a href="{% url 'listing_detail_buy' listing.book.url listing.booklistingid %}">
                                                        {{ listing.book.titlecz }}
                                                    </a>
                                                </p>
                                                <p>{{ listing.book.author }}</p>
                                                <p class="book-market-price books">
                                                    {% if listing.price %}
                                                        {{ listing.price|floatformat:0 }} 
                                                        Kč
                                                        {% else %}
                                                        Daruji
                                                    {% endif %}
                                                </p>

                                                <p class="book-market-user">
                                                    <small>
                                                        Přidal: 
                                                        <a href="{% url 'user_buy_listings' listing.user.id %}" class="books">
                                                            {{ listing.user.username }}
                                                        </a>
                                                        <span> • </span>
                                                        {{ listing.createdat|date:"j.n.Y" }}
                                                    </small>
                                                </p>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>



						<!-- META STATS -->
						<div class="card">
							<div class="card-body">
								<h3 class="card-title after-h3">Statistiky DIV</h3>

                                <div>
                                    <h4>Filmy</h4>
                                    <ul class="list-unstyled mt-2" style="line-height: 1.6; font-size: 14px; margin-left: 1rem;">
                                        <li>&#127902;&#65039; Filmy: {{ metastats.MoviesCount|intcomma }}</li>
                                        <li>&#11088; Hodnocení filmů: {{ metastats.MovieRatingsCount|intcomma }}</li>
                                        <li>&#128161; Filmové zajímavosti: {{ metastats.MovieTriviaCount|intcomma }}</li>
                                        <li>&#128495;&#65039; Filmové hlášky: {{ metastats.MovieQuotesCount|intcomma }}</li>
                                        <li>&#128030; Filmové chyby: {{ metastats.MovieErrorsCount|intcomma }}</li>
                                    </ul>
                                </div>
                                <hr>
                                <div>
                                    <h4>Seriály</h4>
                                    <ul class="list-unstyled" style="line-height: 1.6; font-size: 14px; margin-left: 1rem;">    
                                        <li>&#128250;&#65039; Seriály: {{ metastats.TVShowsCount|intcomma }}</li>
                                        <li>&#128253; Sezóny: {{ metastats.TVSeasonsCount|intcomma }}</li>
                                        <li>&#9654; Epizody: {{ metastats.TVEpisodesCount|intcomma }}</li>
                                    </ul>
                                </div>
                                <hr>
                                <div>
                                    <h4>Knihy</h4>
                                    <ul class="list-unstyled" style="line-height: 1.6; font-size: 14px; margin-left: 1rem;">
                                        <li>&#128214;&#65039; Knihy: {{ metastats.BooksCount|intcomma }}</li>
                                        <li>&#11088; Hodnocení knih: {{ metastats.BookRatingsCount|intcomma }}</li>
                                        <li>&#128172;&#65039; Knižní komentáře: {{ metastats.BookCommentsCount|intcomma }}</li>
                                        <li>&#128495;&#65039; Knižní citáty: {{ metastats.BookQuotesCount|intcomma }}</li>
                                        <li>&#9997; Spisovatelé: {{ metastats.BookWritersCount|intcomma }}</li>
                                    </ul>
                                </div>
                                <hr>
                                <div>
                                    <h4>Hry</h4>
                                    <ul class="list-unstyled" style="line-height: 1.6; font-size: 14px; margin-left: 1rem;">
                                        <li>&#127918; Hry: {{ metastats.GamesCount|intcomma }}</li>
                                        <li>&#11088; Hodnocení her: {{ metastats.GameRatingsCount|intcomma }}</li>
                                    </ul>
                                </div>
                                <hr>
                                <div>
                                    <h4>Ostatní</h4>
                                    <ul class="list-unstyled" style="line-height: 1.6; font-size: 14px; margin-left: 1rem;">
                                        <li>&#129333; Tvůrci: {{ metastats.CreatorsCount|intcomma }}</li>
                                        <li>&#129497; Postavy: {{ metastats.CharactersCount|intcomma }}</li>
                                        <li>&#128101; Registrovaní uživatelé: {{ metastats.UsersCount|intcomma }}</li>
                                    </ul>
                                </div>

                            </div>
                        </div>


                        </div>
                    </div>
                </section>
            </main>

        {% include "inc/footer_new.html" %}

        <!-- více, méně -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const bioElements = document.querySelectorAll(".biography-text");
                const toggleButtons = document.querySelectorAll(".toggle-biography");

                bioElements.forEach((bioElement, index) => {
                    const fullHTML = bioElement.innerHTML; // Celý text včetně HTML
                    const maxLength = 400; // Požadovaný počet znaků

                    // Vytvořit text bez HTML pro zkrácení
                    const tempElement = document.createElement("div");
                    tempElement.innerHTML = fullHTML;
                    const plainText = tempElement.innerText;

                    // Zkrácený text (bez HTML, ale jen do maxLength znaků)
                    const truncatedText = plainText.substring(0, maxLength);

                    // Zkrácený HTML (pro zobrazení s HTML tagy)
                    let truncatedHTML = "";
                    let charCount = 0;
                    tempElement.childNodes.forEach(node => {
                        if (charCount >= maxLength) return; // Nepřidávat další znaky
                        if (node.nodeType === Node.TEXT_NODE) {
                            // Přidat textový obsah
                            const remainingChars = maxLength - charCount;
                            truncatedHTML += node.textContent.substring(0, remainingChars);
                            charCount += node.textContent.length;
                        } else if (node.nodeType === Node.ELEMENT_NODE) {
                            // Přidat celý HTML tag (rekurzivně zpracovaný)
                            const nodeHTML = node.outerHTML;
                            if (charCount + node.textContent.length <= maxLength) {
                                truncatedHTML += nodeHTML;
                                charCount += node.textContent.length;
                            }
                        }
                    });

                    // Přidat tři tečky na konec, pokud je text zkrácený
                    if (plainText.length > maxLength) {
                        truncatedHTML += "...";
                    }

                    // Nastavit zkrácený text
                    bioElement.innerHTML = truncatedHTML;

                    // Pokud má text více než maxLength znaků, přidat funkci na zobrazení plného textu
                    if (plainText.length > maxLength) {
                        toggleButtons[index].style.display = "inline"; // Zobrazit tlačítko
                        toggleButtons[index].addEventListener("click", function () {
                            if (bioElement.innerHTML === truncatedHTML) {
                                bioElement.innerHTML = fullHTML; // Zobrazit celý text
                                this.innerText = "...Méně"; // Změnit text tlačítka
                            } else {
                                bioElement.innerHTML = truncatedHTML; // Zobrazit zkrácený text
                                this.innerText = "Více..."; // Změnit text tlačítka
                            }
                        });
                    } else {
                        toggleButtons[index].style.display = "none"; // Skryjeme tlačítko
                    }
                });
            });
        </script>

        <!-- carousel ze světa... -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                new Swiper('.card-wrapper', {
                    loop: true,
                    speed: 700,
                    spaceBetween: 20,  // Menší mezera mezi kartami, pokud je příliš velká
                    slidesPerView: 4,  // Na větších obrazovkách zobrazení 4 karet
                    slidesPerGroup: 1,  // Posouvá se vždy o 1 kartu

                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true,
                        dynamicBullets: true,
                    },

                    navigation: {
                        nextEl: '.button-next',
                        prevEl: '.button-prev',
                    },

                    breakpoints: {
                        0: {
                            slidesPerView: 2,  // Na mobilu 2 karty
                            spaceBetween: 10,  // Menší mezera mezi kartami na mobilu
                        },
                        768: {
                            slidesPerView: 3,  // Na tabletu 3 karty
                            spaceBetween: 15,  // Střední mezera mezi kartami na tabletu
                        },
                        1024: {
                            slidesPerView: 4,  // Na desktopu 4 karty
                            spaceBetween: 20,  // Větší mezera mezi kartami na desktopu
                        },
                    },
                });
            });
        </script>

        {% load static %}
        
        <script src="/web/js/script.js"></script>
        <script src="/web/js/index.js"></script>

    </body>
</html>
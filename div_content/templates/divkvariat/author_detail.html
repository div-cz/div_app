{% extends "divkvariat/base.html" %}

{% block title %}{{ author.fullname }} – DIVkvariát{% endblock %}

{% block content %}

<div class="container mx-auto max-w-4xl py-10">

    <!-- Autor -->
    <h1 class="text-4xl font-bold mb-1">
        {{ author.firstname }} {{ author.lastname }}
    </h1>

    {% if author.birthyear %}
        <p class="text-gray-600 mb-6">(*{{ author.birthyear }})</p>
    {% endif %}

    <!-- Knihy -->
    {% for item in book_data %}
    <div class="mb-10 border rounded-lg p-5 bg-white dark:bg-[#0D0C0F] shadow">

        <div class="flex gap-4">
            <!-- Obálka -->
            <a href="{% url 'book_detail_cz' item.book.url %}">
                {% if item.book.img == "noimg.png" %}
                    <img src="/static/img/book/book.png" class="w-28 rounded">
                {% elif item.book.img == "GoogleID" %}
                    <img src="https://books.google.com/books/content?id={{ item.book.googleid }}&printsec=frontcover&img=1&zoom=1"
                         class="w-28 rounded">
                {% else %}
                    <img src="https://media.div.cz/knihy/{{ item.book.img }}" class="w-28 rounded">
                {% endif %}
            </a>

            <!-- Info -->
            <div class="flex-1">
                <h2 class="text-2xl font-bold mb-2">
                    <a href="{% url 'book_detail_cz' item.book.url %}" class="hover:underline">
                        {{ item.book.titlecz|default:item.book.title }}
                    </a>
                </h2>

                {% if item.book.year %}
                    <p class="text-gray-600 mb-2">Rok vydání: {{ item.book.year }}</p>
                {% endif %}

                <p class="text-gray-700 mb-3">
                    <strong>Prodáno:</strong> {{ item.sold_count }}× |
                    <strong>Nabídky:</strong> {{ item.active_sells.count }} |
                    <strong>Poptávky:</strong> {{ item.active_buys.count }}
                </p>

                <!-- Nabídky -->
                {% if item.active_sells %}
                    <h3 class="font-semibold">Aktivní nabídky:</h3>
                    {% for listing in item.active_sells %}
                        <div class="ml-4 mb-1">
                            • {{ listing.price }} Kč  
                            <a class="underline text-sm text-blue-600"
                               href="{% url 'listing_detail_sell' item.book.url listing.booklistingid %}">
                               detail
                            </a>
                        </div>
                    {% endfor %}
                {% endif %}

                <!-- Poptávky -->
                {% if item.active_buys %}
                    <h3 class="font-semibold mt-2">Aktivní poptávky:</h3>
                    {% for listing in item.active_buys %}
                        <div class="ml-4 mb-1">
                            • {{ listing.price }} Kč  
                            <a class="underline text-sm text-blue-600"
                               href="{% url 'listing_detail_buy' item.book.url listing.booklistingid %}">
                               detail
                            </a>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>

        </div>

    </div>
    {% endfor %}
</div>

{% endblock %}

{% extends "divkvariat/base.html" %}
{% load humanize %}

{% block title %}Nab√≠dky knih | DIVkvari√°t{% endblock %}

{% block content %}

<div class="listings-page">
    <h1 class="section-title">üìö Nab√≠dky knih</h1>

    <p class="listings-intro">
        Aktu√°ln√≠ nab√≠dky od ƒçten√°≈ô≈Ø DIVkvari√°tu.
        Prodej, darov√°n√≠ i sbƒõratelsk√© kousky.
    </p>

    <!-- KATEGORIE -->
    {% if categories %}
        <div class="listings-filters">

            <h2 class="section-subtitle">Kategorie</h2>

            <div class="filter-list">
                {% for g in categories %}
                    <a href="?zanr={{ g.url }}"
                    class="filter-pill
                    {% if selected_genre == g.url %}active{% endif %}
                    {% if forloop.counter > 2 %}hidden-mobile{% endif %}">
                        {{ g.genrenamecz }}
                    </a>
                {% endfor %}
            </div>

            <a href="#"
            onclick="showHidden(this)"
            class="filter-more">
                Zobrazit v≈°echny
            </a>
        </div>
    {% endif %}

    <!-- TOP PRODEJCI -->
    {% if top_sellers %}
        <div class="listings-filters">

            <h2 class="section-subtitle">Top prodejci</h2>

            <div class="filter-list">
                {% for seller in top_sellers %}
                    <a href="/uzivatel/{{ seller.id }}/prodam-knihy/"
                    class="filter-pill {% if forloop.counter > 2 %}hidden-mobile{% endif %}">
                        üì¶ {{ seller.username }}
                        <span class="filter-meta">({{ seller.total_sales }})</span>
                    </a>
                {% endfor %}
            </div>

            <a href="#"
            onclick="showHidden(this)"
            class="filter-more">
                Zobrazit v≈°echny
            </a>
        </div>
    {% endif %}

    <!-- LIST NAB√çDEK -->
    {% if listings %}
        <div class="listing-grid">

            {% for listing in listings %}
            <div class="listing-card">

                <a href="{% url 'listing_detail_sell' listing.book.url listing.booklistingid %}"
                class="listing-image">
                    {% if listing.book.img == "noimg.png" %}
                        <img src="https://media.div.cz/img/book/book.png" alt="">
                    {% elif listing.book.img == "GoogleID" %}
                        <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1" alt="">
                    {% else %}
                        <img src="https://media.div.cz/knihy/{{ listing.book.img }}" alt="">
                    {% endif %}
                </a>

                <h3 class="listing-title">
                    {{ listing.book.titlecz|default:listing.book.title }}
                </h3>

                <p class="listing-author">
                    {{ listing.book.author }}
                </p>

                <div class="listing-price {% if not listing.price %}free{% endif %}">
                    {% if listing.price %}
                        {{ listing.price|floatformat:0 }} Kƒç
                    {% else %}
                        Daruji
                    {% endif %}
                </div>

                <a href="{% url 'listing_detail_sell' listing.book.url listing.booklistingid %}"
                class="listing-button">
                    Detail nab√≠dky
                </a>

                <div class="listing-meta">
                    P≈ôidal:
                    <a href="/uzivatel/{{ listing.user.id }}/prodam-knihy/">
                        {{ listing.user.username }}
                    </a><br>
                    {{ listing.createdat|date:"j. n. Y" }}
                </div>

            </div>
            {% endfor %}

        </div>

        <!-- PAGINACE -->
        <div class="pagination">

            {% if listings.has_previous %}
                <a href="?page=1{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}">¬´ Prvn√≠</a>
                <a href="?page={{ listings.previous_page_number }}{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}">‚Äπ</a>
            {% endif %}

            <span class="pagination-current">
                Str√°nka {{ listings.number }} / {{ listings.paginator.num_pages }}
            </span>

            {% if listings.has_next %}
                <a href="?page={{ listings.next_page_number }}{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}">‚Ä∫</a>
                <a href="?page={{ listings.paginator.num_pages }}{% if selected_genre %}&zanr={{ selected_genre }}{% endif %}">Posledn√≠ ¬ª</a>
            {% endif %}

        </div>

        {% else %}
        <p class="listings-empty">
            Moment√°lnƒõ zde nejsou ≈æ√°dn√© nab√≠dky.
        </p>
    {% endif %}

</div>

<script>
    function showHidden(el) {
        el.previousElementSibling
        .querySelectorAll('.hidden-mobile')
        .forEach(x => x.classList.remove('hidden-mobile'));
        el.remove();
    }
</script>

{% endblock %}

{% extends "books/base.html" %}
{% load humanize %}
{% load i18n %}
{% load ratings %}
{% load static %}

{% block title %}Knihy | DIV.cz{% endblock %}

{% block meta %}
    <meta name="description" content="Databáze knih na DIV.cz. Objevte novinky, recenze, žebříčky, autory a další informace o vašich oblíbených knihách.">
    <link rel="canonical" href="https://div.cz/knihy/">

    <meta name="keywords" content="knihy, literatura, databáze knih, recenze, novinky, žebříčky, autoři, knižní novinky">
    <meta name="author" content="DIV.cz">

    <meta property="og:title" content="Knihy | Databáze knih na DIV.cz">
    <meta property="og:description" content="Prozkoumejte nejnovější knihy na DIV.cz. Aktuální recenze, novinky a žebříčky.">
    <meta property="og:image" content="https://div.cz/img/book/knizni-div.webp">
    <meta property="og:url" content="https://div.cz/knihy/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Knihy | Databáze DIV.cz">
    <meta name="twitter:description" content="Aktuální databáze knih na DIV.cz. Recenze, novinky, a více.">
    <meta name="twitter:image" content="https://div.cz/img/book/knizni-div.webp">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick-theme.css">

    <script src="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick.min.js"></script>

    <style>
        .rating {
            position: relative;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-top: 0;
            margin-right: 0;
            padding: 0;
            box-shadow: 0px 8px 16px rgb(147 147 147);
        }

        .rating::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 44px;
            height: 44px;
            background: #444444;
            border-radius: 50%;
            z-index: 2;
            margin: 0;
        }

        .rating::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 50px;
            height: 50px;
            background: conic-gradient(
                var(--gradient-color, #0a0) 0%,
                var(--gradient-color, #0a0) var(--gradient-value, 50%),
                #777777 var(--gradient-value, 50%)
            );
            border-radius: 50%;
            z-index: 1;
            margin: 0;
        }

        .rating-inner {
            position: relative;
            z-index: 3;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            /* margin-top: 10px;
            margin-right: -10px; */
        }

        .rating-inner span {
            font-size: 10px;
            margin-left: 2px;
            color: #ffd700;
        }

        .rating:is(.dark *) {
            box-shadow: none;
        }

        .slick-dots {
            margin-bottom: 20px;
        }

        :is(.dark) .slick-dots li button:before {
            color: #ffffff;
        }

    </style>

{% endblock %}


{% block content %}

<div class="container">
    <!-- LEVÁ STRANA -->
    <div class="left-side">
        <!-- CAROUSEL -->
        <div class="book-slider">
            {% for book in top_books %}
                <div class="book-item"> 
                    <a href="/kniha/{{ book.url }}">
                        <img src="{% if book.img == 'noimg.png' %}https://div.cz/static/img/book/book.png {% elif book.img == 'GoogleID' %}https://books.google.com/books/content?id={{ book.googleid }}&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api {% else %}https://media.div.cz/knihy/{{ book.img }}{% endif %}" alt="{{ book.titlecz|default:book.title }}">
                    </a>
                    <a style="width: 100%; min-height: 46px;" href="/kniha/{{ book.url }}">
                        <h3 class="card-text">
                            {{ book.titlecz|default:book.title }}
                        </h3>
                    </a>
                    <p style="width: 100%; min-height: 46px;">{{ book.author }}</p>
                </div>
            {% endfor %}
        </div>

        {% if messages %}
            <div style="margin-top: .75rem;">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}" role="alert">
                        {{ message|safe }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- generování knih -->
        <div style="margin-bottom: 1rem;">
            <div class="generating-books">
                {% for book in book_list_15 %} 
                    <div class="book-card">
                        <a href="/kniha/{{ book.url }}" style="width: 130px;">
                            {% if book.img == "noimg.png" %}
                                <!-- Pokud je book.img "noimg.png", zobraz výchozí obrázek -->
                                <img src="/static/img/book/book.png" alt="Kniha {{ book.titlecz|default:book.title }}" style="height: 100%;">
                                {% elif book.img == "GoogleID" %}
                                <!-- Pokud je book.img "GoogleID", zobraz náhled z Google Books -->
                                <img src="https://books.google.com/books/content?id={{ book.googleid }}&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api" alt="{{ book.titlecz|default:book.title }}" style="height: 100%;">
                                {% else %}
                                <!-- Jinak zobraz vlastní nahraný obrázek -->
                                <img src="https://media.div.cz/knihy/{{ book.img }}" alt="{{ book.titlecz|default:book.title }}" style="height: 100%;">
                            {% endif %}   
                        </a>

                        <div class="card-body" style="width: min-content;">
                            <div class="card-header">
                                <div>
                                    <h4>
                                        <a href="/kniha/{{ book.url }}">
                                        {{ book.titlecz|default:book.title }}
                                        </a>
                                    </h4>
                                    <h4>
                                        {% if book.authorid and book.authorid.url %}
                                            <a href="{% url 'author_detail' author_url=book.authorid.url %}">{{ book.author }}</a>
                                        {% else %}
                                            {{ book.author }}
                                        {% endif %}
                                    </h4>
                                </div>

                                <!-- hodnocení -->
                                <div style="display: flex; width: 50px;">
                                    <div class="rating" data-rating="{{ book.average_rating }}">
                                        <div class="rating-inner">
                                            {{ book.average_rating }}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p class="card-text">{{ book.description|default_if_none:""|safe }}</p>
                            
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Poslední knižní recenze -->
        <div class="card">
            <div class="card-body">
                <div class="card-title after-h3">
                    <h3>&#128221;&#65039; Poslední knižní recenze</h3><a href="/knihy/"><small>Zobrazit vše</small></a>
                </div>
  
                {% if latest_comments %} 
                    {% for comment in latest_comments %}  
                        <div class="last-review">  
                            {% if comment.bookid.img == "noimg.png" %} 
                                <img src="/static/img/book/book.png" alt="Kniha {{ comment.bookid.titlecz }}" class="img-fluid" style="object-fit: cover; max-width: 100px; margin-right: .5rem;">
                                {% elif comment.bookid.img == "GoogleID" %}
                                <img src="https://books.google.com/books/content?id={{ comment.bookid.googleid }}&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api" alt="{{ comment.bookid.titlecz }}" class="img-fluid" style="object-fit: cover; max-width: 100px; margin-right: .5rem;">
                                {% else %}
                                <img src="https://media.div.cz/knihy/{{ comment.bookid.img }}" alt="{{ comment.bookid.titlecz }}" class="img-fluid" style="object-fit: cover; max-width: 100px; margin-right: .5rem;">
                            {% endif %}        
                
                            <div class="last-review-body">
                                <div class="last-review-title">
                                    <a href="{% url 'book_detail' comment.bookid.url %}#recenze">{{ comment.bookid.titlecz|default:comment.bookid.title }}</a>
                                    <p class="last-review-text">{{ comment.comment }}</p>
                                </div>
                                
                                <div class="last-review-user">
                                    <p>Uživatel:
                                        {% if comment.user %}
                                            <a href="/uzivatel/{{ comment.user.id }}/">{{ comment.user.username }}</a>
                                        {% endif %}
                                    </p> 
                                    <span>{{ comment.dateadded|date:"d.m.Y H:i" }}</span>
                                </div>
                            </div> 
                        </div>

                        {% if not forloop.last %}
                            <hr style="margin: .75rem 0;">
                        {% endif %}
                    {% endfor %} 
                    
                    {% else %}
                    <p>Zatím žádné recenze od komunity.</p>
                {% endif %}
            </div>
        </div>
    </div>
   
    <!-- PRAVÁ STRANA -->
    <div class="right-side ">

        <!-- Čtenářský cíl přečtených knih by Martin -->
        <div class="card">
            {% if user.is_authenticated %}
                {% if reading_goal %}
                    <div class="card-body">
                        <h3 class="card-title after-h3">
                            Cíl čtení pro rok {{ reading_goal.goalyear }}
                        </h3>

                        <div class="reading-goal">
                            <span class="reading-goal-text">
                                Přečtených {{ reading_goal.booksread }} / {{ reading_goal.goal }} knih
                            </span>

                            <div class="progress-bar">
                                <div class="progress-bar-fill" style="width: {% if reading_goal.progress > 100 %}100{% else %}{{ reading_goal.progress }}{% endif %}%">
                                    <span class="bar-book">
                                        {{ reading_goal.progress|floatformat:1 }}%
                                    </span>
                                </div>

                                {% if reading_goal.progress == 0 %}
                                    <span class="progress-zero">0%</span>
                                {% endif %}
                            </div>
                        </div>

                        {% if reading_goal.progress >= 100 %}
                            <div class="goal-complete">
                                Gratulujeme! Splnili jste svůj čtenářský cíl!
                            </div>
                        {% endif %}

                        <hr>

                        <form id="goalForm" class="goal-form" method="POST" action="{% url 'set_reading_goal' %}">
                            {% csrf_token %}
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="goal">
                                    Upravit cíl pro rok {{ reading_goal.goalyear }}
                                </label>
                                <input style="width: 100%;" type="number" name="goal" id="goal" min="1" value="{{ reading_goal.goal }}" >
                            </div>

                            <button type="submit" class="btn add-book">
                                <i class="fa fa-save"></i> Uložit
                            </button>
                        </form>
                    </div>

                    {% else %}
                    <div class="goal-empty">
                        <p>Nastavte si svůj první čtenářský cíl!</p>
                        <form id="goalForm" class="goal-form-start" method="POST" action="{% url 'set_reading_goal' %}">
                            {% csrf_token %}
                            <div class="form-row">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <input style="width: 100%;" type="number" name="goal" placeholder="Např. 12" min="1">
                                    <span class="input-suffix">knih</span>
                                </div>

                                <button type="submit" class="btn add-book">
                                    Začít
                                </button>
                            </div>
                        </form>
                    </div>
                {% endif %}

                {% else %}
                <p class="card-body">
                    Pro nastavení vlastního čtenářského cíle se prosím
                    <a href="/prihlaseni/">přihlašte</a>.
                </p>
            {% endif %}
        </div>

        <!-- BURZA KNIH -->
        <div class="card">
            <div class="card-body">
                <h3 class="card-title after-h3">&#128717; Burza knih</h3>

                <!-- prodej -->
                <div class="book-market">
                    <div class="book-market-title">
                        <h4>Prodej</h4>
                        <div>
                            <a href="{% url 'books_market_offers' %}">
                                <small>Zobrazit vše</small>
                            </a>
                            {% if user.is_authenticated %}
                                <span> | </span>
                                <a href="{% url 'user_sell_listings' user.id %}">
                                    <small>Zobrazit moje</small>
                                </a>
                            {% endif %}
                        </div>
                    </div>

                    {% for listing in recent_sell_listings %}
                        <div class="book-market-body">
                            <a href="{% url 'listing_detail_sell' listing.book.url listing.booklistingid %}">
                                {% if listing.book.img == "noimg.png" %}
                                    <img src="/static/img/book/book.png" alt="Kniha {{ listing.book.titlecz|default:listing.book.title }}">
                                    {% elif listing.book.img == "GoogleID" %}
                                    <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api" alt="{{ listing.book.titlecz|default:listing.book.title }}">
                                    {% else %}
                                    <img src="https://media.div.cz/knihy/{{ listing.book.img }}" alt="{{ listing.book.titlecz }}">
                                {% endif %}
                            </a>

                            <div class="book-market-text">
                                <p>
                                    <a href="{% url 'listing_detail_sell' listing.book.url listing.booklistingid %}">
                                        {{ listing.book.titlecz|default:listing.book.title }}
                                    </a>
                                </p>

                                <p>{{ listing.book.author }}</p>

                                <p class="book-market-price books">
                                    {% if listing.price %}
                                        {{ listing.price|floatformat:0 }} 
                                        Kč
                                        {% else %}
                                        Daruji
                                    {% endif %}
                                </p>

                                <p class="book-market-user">
                                    <small>
                                        Přidal: 
                                        <a href="{% url 'user_sell_listings' listing.user.id %}">
                                            {{ listing.user.username }}
                                        </a>
                                        <span> | </span>
                                        {{ listing.createdat|date:"j.n.Y" }}
                                    </small>
                                </p>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <hr>

                <!-- poptávka -->
                <div class="book-market">
                    <div class="book-market-title">
                        <h4>Poptávka</h4>
                        <div>
                            <a href="{% url 'books_market_wants' %}">
                                <small>Zobrazit vše</small>
                            </a>
                            {% if user.is_authenticated %}
                                <span> | </span>
                                <a href="{% url 'user_buy_listings' user.id %}">
                                    <small>Zobrazit moje</small>
                                </a>
                            {% endif %}
                        </div>
                    </div>

                    {% for listing in recent_buy_listings %}
                        <div class="book-market-body">
                            <a href="{% url 'listing_detail_buy' listing.book.url listing.booklistingid %}">
                                {% if listing.book.img == "noimg.png" %}
                                    <img src="/static/img/book/book.png" alt="Kniha {{ listing.book.titlecz|default:listing.book.title }}">
                                    {% elif listing.book.img == "GoogleID" %}
                                    <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api" alt="{{ listing.book.titlecz|default:listing.book.title }}">
                                    {% else %}
                                    <img src="https://media.div.cz/knihy/{{ listing.book.img }}" alt="{{ listing.book.titlecz }}">
                                {% endif %}
                            </a>

                            <div class="book-market-text">
                                <p>
                                    <a href="{% url 'listing_detail_buy' listing.book.url listing.booklistingid %}">
                                        {{ listing.book.titlecz|default:listing.book.title }}
                                    </a>
                                </p>

                                <p>{{ listing.book.author }}</p>

                                <p class="book-market-price books">
                                    {% if listing.price %}
                                        {{ listing.price|floatformat:0 }} 
                                        Kč
                                        {% else %}
                                        Daruji
                                    {% endif %}
                                </p>
                                
                                <p class="book-market-user">
                                    <small>
                                        Přidal: 
                                        <a href="{% url 'user_buy_listings' listing.user.id %}">
                                            {{ listing.user.username }}
                                        </a>
                                        <span> | </span>
                                        {{ listing.createdat|date:"j.n.Y" }}
                                    </small>
                                </p>
                            </div>
                        </div>
                    {% endfor %}
                </div>

            </div>
        </div>

        <!-- PRÁVĚ VYŠLO -->
        <div class="card">
            <div class="card-body">
                <h3 class="card-title after-h3">&#127381; Právě vyšlo</h3>
                <ul style="list-style-type:none">
                    <li><a href="https://test.div.cz/kniha/sikmy-kostel-3">Šikmý kostel 3</a></li>
                    <li><a href="https://div.cz/kniha/ctvrte-kridlo">Čtvrté křídlo</a></li>
                    <li><a href="https://div.cz/kniha/murtagh">Murtagh</a></li>
                    <li>Duše národa</li>
                    <li>Lovec přízraků</li>
                    <li>Sedm schodů k moci</li>
                    <li>Duna - retro vydání</li>
                </ul>
            </div>
        </div>

        <!-- ČLÁNKY -->
        <div class="card">
            <div class="card-body">
                <div class="card-title after-h3">
                    <h3>&#128240;&#65039; Články</h3>
                    <a href="{% url 'articles_list' category='knihy' %}"><small>Zobrazit vše</small></a>
                </div>
                <div class="article-head-title after">
                    <a href="https://div.cz/magnesia-litera-2024-svatek-ceske-literatury">Magnesia Litera 2024</a>
                    <a href="https://div.cz/literarni-cena-skleneny-klic-glasnyckeln">Skleněný klíč</a>
                    <a href="/odhaleni-kouzla-slova-nobelova-cena-za-literaturu">Nobelova cena za literaturu</a>
                    <a href="https://div.cz/pridej-svou-knihu">Přidej svou e-knihu</a>
                </div>
                <div style="text-align: right;">
                    {% if user.is_superuser %}
                        <a href="{% url 'article_new' category=category_key %}"><i class="fa-solid fa-plus"></i> Přidat nový článek</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- AUTOŘI -->
        <div class="card">
            <div class="card-body">
                <h3 class="card-title after-h3">&#129333; Autoři měsíce</h3>
                <ul>
                    <li><a href="https://div.cz/autor/karin-lednicka">Karin Lednická</a></li>
                    <li><a href="https://div.cz/autor/christopher-paolini">Christopher Paolini</a></li>
                    <li><a href="https://div.cz/autor/jo-nesbo">Jo Nesbø</a></li>
                    <li><a href="https://div.cz/autor/rebecca-yarros">Rebecca Yarros</a></li>
                    <li><a href="https://div.cz/autor/robert-bryndza">Robert Bryndza</a></li>
                    <li><a href="https://div.cz/autor/orson-welles">Orson Welles</a></li>
                </ul>
            </div>
        </div>

        <!-- ŽÁNRY -->
        <div class="card">
            <div class="card-body">
                <h3 class="card-title after-h3">&#127917; Žánry</h3>
                <div>
                    <a href="/knihy/biografie-a-autobiografie">Biografie a autobiografie</a> |
                    <a href="/knihy/cestopisy">Cestopisy</a> |
                    <a href="/knihy/krimi">Detektivní</a> |
                    <a href="/knihy/dobrodruzne">Dobrodružné</a> |
                    <a href="/knihy/detske">Dětské</a> |
                    <a href="/knihy/eroticke">Erotické</a> |
                    <a href="/knihy/fantasy">Fantasy</a> | 
                    <a href="/knihy/historicky">Historie</a> | 
                    <a href="/knihy/horor">Horor</a> |
                    <a href="/knihy/humor-a-zabava">Humorné</a> |
                    <a href="/knihy/komiksy-a-graficke-romany">Komiks</a> |
                    <a href="/knihy/literatura-faktu">Literatura faktu</a> |
                    <a href="/knihy/odborna">Odborná</a> |
                    <a href="/knihy/poezie">Poezie</a> |
                    <a href="/knihy/pohadky">Pohádky</a> |
                    <a href="/knihy/popularne-naucne">Populárně-naučné</a> |
                    <a href="/knihy/povidky">Povídky</a> |
                    <a href="/knihy/pro-mladez">Pro mládež</a> |
                    <a href="/knihy/romanticky">Romantický</a> |
                    <a href="/knihy/sci-fi">Sci-fi</a> |
                    <a href="/knihy/sportovni">Sportovní</a> |
                    <a href="/knihy/thriller">Thriller</a> |
                    <a href="/knihy/umeni-a-fotografie">Umění</a> |
                    <a href="/knihy/valecne">Válečné</a> |
                    <a href="/knihy/western">Western</a> |
                    <a href="/knihy/young-adult">Young adult</a>
                </div>
            </div>
        </div>

        <!-- STATISTIKY -->
        <div class="card">
            <div class="card-body">
                <h3 class="card-title after-h3">&#128202;&#65039; Knižní statistiky DIV</h3>
                <ul>
                    <li><p>{{ stats_book.value|intcomma }} knih</p></li>
                    <li><p>{{ stats_writters.value|intcomma }} spisovatelů</p></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- CAROUSEL -->
<script>
    $(document).ready(function(){
        $('.book-slider').slick({
            infinite: true, // nekonečný scroll
            slidesToShow: 3, // počet obrázků na stránce
            slidesToScroll: 1, // posun o 1 obrázek
            autoplay: true, // automatické přehrávání
            autoplaySpeed: 2000, // rychlost automatického posouvání v milisekundách
            dots: true, // navigační tečky
            arrows: false, // Zakáže boční šipky
            responsive: [
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: 1
                    }
                },
                {
                    breakpoint: 1024,
                    settings: {
                        slidesToShow: 2
                    }
                }
            ]
        });
    });
</script>

{% endblock %}

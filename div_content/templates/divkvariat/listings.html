{% extends "divkvariat/base.html" %}
{% load humanize %}

{% block title %}
Nabídky knihy {{ book.titlecz|default:book.title }} | DIVkvariát
{% endblock %}

{% block content %}

<div class="page page-narrow">
    <!-- HLAVIČKA KNIHY -->
    <header class="page-header">
        <h1 class="page-title">
            {{ book.titlecz|default:book.title }}
        </h1>
        <p class="page-subtitle">
            {{ book.author }}
        </p>
    </header>

    <!-- NABÍDKY -->
    {% if sell_listings %}
        <section class="section">

            <h2 class="section-title">
                <i class="fas fa-book"></i>
                Nabídky k prodeji
            </h2>

            <div class="listing-list">
                {% for listing in sell_listings %}
                    <article class="card listing-row">

                        <div class="listing-header">
                            <div class="listing-price">
                                {% if listing.listingtype == 'GIVE' %}
                                    Daruji
                                    {% else %}
                                    {{ listing.price|intcomma }} Kč
                                {% endif %}

                                {% if listing.shipping %}
                                    <span class="listing-shipping">
                                        + {{ listing.shipping|intcomma }} Kč poštovné
                                    </span>
                                {% endif %}
                            </div>

                            <div class="listing-date">
                                {{ listing.createdat|naturaltime }}
                            </div>
                        </div>

                        <p class="listing-description">
                            {{ listing.description|default:"Bez popisu" }}
                        </p>

                        <div class="listing-meta">
                            {% if listing.condition %}
                                <span>Stav: <strong>{{ listing.get_condition_display }}</strong></span>
                            {% endif %}

                            {% if listing.location %}
                                <span>Lokalita: <strong>{{ listing.location }}</strong></span>
                            {% endif %}
                        </div>

                        <div class="listing-actions">
                            <a href="{% url 'user_sell_listings' listing.user.id %}"
                            class="listing-user">
                                {{ listing.user.username }}
                            </a>

                            <a href="{% url 'listing_detail_sell' book.url listing.booklistingid %}"
                            class="btn-outline">
                                Detail nabídky
                            </a>
                        </div>

                    </article>
                {% endfor %}
            </div>

        </section>
    {% endif %}

    <!-- POPTÁVKY -->
    {% if buy_listings %}
        <section class="section">

            <h2 class="section-title">
                <i class="fas fa-hand-holding-heart"></i>
                Poptávky
            </h2>

            <div class="listing-list">
                {% for listing in buy_listings %}
                    <article class="card listing-row">
                        <div class="listing-header">
                            <div class="listing-price want">
                                Koupím – {{ listing.price|intcomma }} Kč
                            </div>

                            <div class="listing-date">
                                {{ listing.createdat|naturaltime }}
                            </div>
                        </div>

                        <p class="listing-description">
                            {{ listing.description }}
                        </p>

                        {% if listing.location %}
                            <div class="listing-meta">
                                Lokalita: <strong>{{ listing.location }}</strong>
                            </div>
                        {% endif %}

                        <div class="listing-actions">
                            <a href="{% url 'user_buy_listings' listing.user.id %}"
                            class="listing-user">
                                {{ listing.user.username }}
                            </a>

                            <a href="{% url 'listing_detail_buy' book.url listing.booklistingid %}"
                            class="btn-outline">
                                Detail poptávky
                            </a>
                        </div>

                    </article>
                {% endfor %}
            </div>

        </section>
    {% endif %}

    {% if not sell_listings and not buy_listings %}
        <p class="empty-state">
            Pro tuto knihu zatím nejsou žádné nabídky ani poptávky.
        </p>
    {% endif %}

</div>

{% endblock %}

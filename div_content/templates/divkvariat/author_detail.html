{% extends "divkvariat/base.html" %}

{% block title %}{{ author.firstname }} {{ author.lastname }} – DIVkvariát{% endblock %}

{% block content %}

<div class="author-page">
    <!-- HLAVNÍ INFO O AUTOROVI -->
    <div class="author-header">
        <h1 class="author-name">
            {{ author.firstname }} {{ author.lastname }}
        </h1>

        {% if author.birthyear %}
            <p class="author-birthyear">(*{{ author.birthyear }})</p>
        {% endif %}

        {% if author.bio %}
            <p class="author-bio">{{ author.bio }}</p>
        {% endif %}
    </div>

    <!-- VÝPIS KNIH -->
    {% for item in book_data %}
        <div class="author-book">
            <div class="author-book-inner">
                <!-- OBÁLKA -->
                <a href="{% url 'book_detail_cz' item.book.url %}" class="author-book-cover">
                    {% if item.book.img == "noimg.png" %}
                        <img src="/static/img/book/book.png">
                    {% elif item.book.img == "GoogleID" %}
                        <img src="https://books.google.com/books/content?id={{ item.book.googleid }}&printsec=frontcover&img=1&zoom=1">
                    {% else %}
                        <img src="https://media.div.cz/knihy/{{ item.book.img }}">
                    {% endif %}
                </a>

                <!-- INFO O KNIZE -->
                <div class="author-book-info">

                    <h2 class="author-book-title">
                        <a href="{% url 'book_detail_cz' item.book.url %}">
                            {{ item.book.titlecz|default:item.book.title }}
                        </a>
                    </h2>

                    {% if item.book.year %}
                        <p class="author-book-year">
                            Rok vydání: {{ item.book.year }}
                        </p>
                    {% endif %}

                    <p class="author-book-stats">
                        <strong>Prodáno:</strong> {{ item.sold_count }}× |
                        <strong>Nabídky:</strong> {{ item.active_sells.count }} |
                        <strong>Poptávky:</strong> {{ item.active_buys.count }}
                    </p>

                    {% if item.active_sells %}
                        <div class="author-listings">
                            <h3>Aktivní nabídky:</h3>
                            {% for listing in item.active_sells %}
                                <div class="author-listing-item">
                                    • <strong>{{ listing.price }} Kč</strong>
                                    <a href="{% url 'listing_detail_sell' item.book.url listing.booklistingid %}">
                                        detail
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% if item.active_buys %}
                        <div class="author-listings">
                            <h3>Aktivní poptávky:</h3>
                            {% for listing in item.active_buys %}
                                <div class="author-listing-item">
                                    • <strong>{{ listing.price }} Kč</strong>
                                    <a href="{% url 'listing_detail_buy' item.book.url listing.booklistingid %}">
                                        detail
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                </div>

            </div>

        </div>
    {% endfor %}

</div>

{% endblock %}

{% extends "divkvariat/base.html" %}
{% load humanize %}

{% block title %}
    Popt√°vky knih | DIVkvari√°t
{% endblock %}

{% block meta %}
<meta name="description" content="Popt√°vky knih od ƒçten√°≈ô≈Ø na DIVkvari√°tu. Zjistƒõte, kter√© knihy lid√© sh√°nƒõj√≠.">
<link rel="canonical" href="https://divkvariat.cz/poptavky/">

<meta property="og:title" content="Popt√°vky knih | DIVkvari√°t">
<meta property="og:description" content="Aktu√°ln√≠ popt√°vky knih od u≈æivatel≈Ø DIVkvari√°tu.">
<meta property="og:image" content="https://media.div.cz/hero/divkvariat.webp">
<meta property="og:url" content="https://divkvariat.cz/poptavky/">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Popt√°vky knih | DIVkvari√°t">
<meta name="twitter:description" content="Knihy, kter√© ƒçten√°≈ôi aktu√°lnƒõ popt√°vaj√≠.">
<meta name="twitter:image" content="https://media.div.cz/hero/divkvariat.webp">
{% endblock %}

{% block content %}

<div class="max-w-7xl mx-auto py-10">

    <h1 class="text-3xl font-bold text-gray-800 mb-2">üìò Popt√°vky knih</h1>
    <p class="text-gray-600 mb-10">
        ƒåten√°≈ôi zde popt√°vaj√≠ knihy, kter√© sh√°nƒõj√≠.  
        Pokud knihu m√°te, m≈Ø≈æete zalo≈æit nab√≠dku.
    </p>

    <!-- Kategorie -->
    {% if categories %}
    <div class="mb-10">
        <h2 class="text-xl font-semibold mb-3">Kategorie</h2>
        <div class="flex flex-wrap gap-3">
            {% for cat in categories %}
                <a href="?kategorie={{ cat.slug }}"
                   class="px-4 py-2 bg-white border border-gray-200 rounded-lg shadow-sm hover:bg-gray-50 text-gray-700">
                    {{ cat.name }}
                </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Top kupci -->
    {% if top_buyers %}
    <div class="mb-10">
        <h2 class="text-xl font-semibold mb-3">Top kupuj√≠c√≠</h2>

        <div class="flex flex-wrap gap-4">
            {% for buyer in top_buyers %}
            <a href="/uzivatel/{{ buyer.id }}/koupim-knihy/"
               class="bg-white border rounded-lg shadow-sm px-4 py-3 hover:shadow-md transition text-gray-800">
                üõí {{ buyer.username }}
                <span class="text-sm text-gray-500 ml-2">({{ buyer.total_buys }} popt√°vek)</span>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- POPT√ÅVKY -->
    {% if listings %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

        {% for listing in listings %}
        <div class="bg-white rounded-xl border shadow-sm hover:shadow-lg transition p-4">

            <!-- Obr√°zek knihy -->
            <a href="{% url 'listing_detail_buy' listing.book.url listing.booklistingid %}">
                {% if listing.book.img == "noimg.png" %}
                    <img src="/static/img/book/book.png"
                         class="w-full h-64 object-cover rounded-md mb-4">
                {% elif listing.book.img == "GoogleID" %}
                    <img src="https://books.google.com/books/content?id={{ listing.book.googleid }}&printsec=frontcover&img=1&zoom=1"
                         class="w-full h-64 object-cover rounded-md mb-4">
                {% else %}
                    <img src="https://media.div.cz/knihy/{{ listing.book.img }}"
                         class="w-full h-64 object-cover rounded-md mb-4">
                {% endif %}
            </a>

            <!-- N√°zev -->
            <h3 class="text-lg font-semibold text-gray-800">
                {{ listing.book.titlecz|default:listing.book.title }}
            </h3>

            <!-- Autor -->
            <p class="text-gray-500 mb-3">{{ listing.book.author }}</p>

            <!-- Nab√≠dnut√° cena -->
            <p class="text-xl font-bold text-blue-600 mb-4">
                Sh√°n√≠m za {{ listing.price|floatformat:0 }} Kƒç
            </p>

            <!-- Detail -->
            <a href="{% url 'listing_detail_buy' listing.book.url listing.booklistingid %}"
               class="block w-full text-center py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold">
                Zobrazit popt√°vku
            </a>

            <!-- Info -->
            <p class="text-xs text-gray-500 mt-3">
                Popt√°v√°:
                <a href="/uzivatel/{{ listing.user.id }}/koupim-knihy/"
                   class="text-green-700 hover:underline">
                    {{ listing.user.username }}
                </a><br>
                {{ listing.createdat|date:"j. n. Y" }}
            </p>

        </div>
        {% endfor %}
    </div>

    <!-- PAGINACE -->
    <div class="flex justify-center mt-10">

        <nav class="flex items-center space-x-2">

            {% if listings.has_previous %}
                <a href="?page=1" class="px-3 py-2 bg-white border rounded-lg shadow-sm hover:bg-gray-50">¬´ Prvn√≠</a>
                <a href="?page={{ listings.previous_page_number }}" class="px-3 py-2 bg-white border rounded-lg shadow-sm hover:bg-gray-50">‚Äπ</a>
            {% endif %}

            <span class="px-4 py-2 bg-gray-100 border rounded-lg">
                Str√°nka {{ listings.number }} / {{ listings.paginator.num_pages }}
            </span>

            {% if listings.has_next %}
                <a href="?page={{ listings.next_page_number }}" class="px-3 py-2 bg-white border rounded-lg shadow-sm hover:bg-gray-50">‚Ä∫</a>
                <a href="?page={{ listings.paginator.num_pages }}" class="px-3 py-2 bg-white border rounded-lg shadow-sm hover:bg-gray-50">Posledn√≠ ¬ª</a>
            {% endif %}

        </nav>

    </div>

    {% else %}
    <p class="text-center text-gray-500 mt-14">
        Moment√°lnƒõ zde nejsou ≈æ√°dn√© popt√°vky.
    </p>
    {% endif %}

</div>

{% endblock %}
